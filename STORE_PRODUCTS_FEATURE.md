# Товары магазина - Документация

## Описание

Добавлена новая вкладка "Товары магазина" в клиентский интерфейс, позволяющая просматривать и загружать карточки товаров из Wildberries через API.

## Расположение

**Клиентский интерфейс:**
- Маршрут: `/client/products`
- Компонент: `client/components/client/StoreProducts.tsx`
- Страница: `client/app/client/products/page.tsx`

## API Endpoints

### Получение списка товаров
```
GET /client/store-products
```
Возвращает список всех товаров текущего клиента из кэша `wb_products_cache`.

### Загрузка карточек товаров
```
POST /client/store-products/load
```
Загружает карточки товаров через Wildberries API. Требует настроенный API ключ Wildberries.

## Функциональность

### Основные возможности:
1. **Просмотр товаров** - отображение всех загруженных товаров из Wildberries
2. **Загрузка карточек** - импорт товаров через кнопку "Загрузить карточки"
3. **Поиск** - фильтрация по названию, артикулу или бренду
4. **Фильтры** - показ всех, только активных или только неактивных товаров
5. **Статистика** - количество товаров, активных, в акциях и средняя цена

### Отображаемые данные:
- Название товара
- Бренд
- Категория
- Артикул поставщика и nmId
- Текущая цена
- Комиссия маркетплейса
- Стоимость логистики
- Статус (активен/неактивен)
- Участие в акциях
- Дата последнего обновления

## Интеграция с Wildberries API

Система использует Content API Wildberries для получения всех карточек товаров:

1. **Метод получения товаров:** `fetchSupplierProducts(apiKey, userId)`
2. **Источник данных:** Content API `/content/v2/get/cards/list` (все карточки товаров)
3. **Кэширование:** Товары сохраняются в таблицу `wb_products_cache`
4. **Документация API:** https://dev.wildberries.ru/openapi/work-with-products

## Требования

### База данных
Таблица `wb_products_cache` должна существовать (создается миграцией `20250121_create_pricing_module.sql`).

### API Ключ
Для работы функции загрузки необходимо настроить API ключ Wildberries:
- В настройках клиента (Settings → API Keys)
- **Важно:** Токен должен быть категории "Content" для доступа к карточкам товаров
- Создать токен: https://seller.wildberries.ru → Профиль → Интеграции → API → Content

## Логирование

Действия администратора по загрузке товаров логируются в таблицу `admin_logs` (для администраторов).

## Использование

### Для клиента:
1. Откройте вкладку "Товары магазина" в боковом меню
2. Нажмите "Загрузить карточки" для импорта товаров
3. Используйте поиск и фильтры для навигации по товарам
4. Просматривайте статистику внизу страницы

### Обработка ошибок:
- Если API ключ не настроен - появится сообщение с инструкцией
- Если загрузка не удалась - отображается детальное сообщение об ошибке
- Если товаров нет - показывается подсказка о необходимости загрузки

## Связанные файлы

**Frontend:**
- `client/components/layout/Sidebar.tsx` - добавлен пункт меню
- `client/components/client/StoreProducts.tsx` - компонент отображения
- `client/app/client/products/page.tsx` - страница

**Backend:**
- `server/routes/client.js` - API endpoints
- `server/services/wildberriesPricingService.js` - сервис получения товаров
- `server/migrations/20250121_create_pricing_module.sql` - структура БД

**Database:**
- `wb_products_cache` - таблица кэша товаров
- `clients.api_keys` - хранение API ключей

## Примечания

1. Загружаются ВСЕ карточки товаров из Wildberries (до 10,000)
2. Для каждого клиента создается отдельный кэш товаров
3. Система использует Content API для получения полного списка товаров
4. Требуется токен категории "Content" (не Statistics или Marketplace)
5. Цена и комиссия обновляются при каждой загрузке

## Устранение проблем

### Загружается мало товаров или ошибка авторизации
**Причина:** Используется неправильный тип токена.

**Решение:**
1. Перейдите в Личный кабинет продавца Wildberries
2. Профиль → Интеграции → API
3. Создайте новый токен категории **"Content"**
4. Обновите ключ в настройках клиента

