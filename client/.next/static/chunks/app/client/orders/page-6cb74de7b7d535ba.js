(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{7463:function(e,s,a){Promise.resolve().then(a.bind(a,3547))},3547:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return u}});var t=a(7437),l=a(2265),r=a(4133),c=a(826),i=a(8102),n=a(4020),d=a(8034),m=a(8801),x=a(6689),o=a(5925);function u(){let[e,s]=(0,l.useState)([]),[a,u]=(0,l.useState)(!0),[h,p]=(0,l.useState)(!1),[j,g]=(0,l.useState)(""),[N,b]=(0,l.useState)("new"),[y,v]=(0,l.useState)(""),[f,w]=(0,l.useState)(1),[S,_]=(0,l.useState)(1),[k,D]=(0,l.useState)(0),[C,U]=(0,l.useState)(!1),[I,R]=(0,l.useState)(!1),[E,L]=(0,l.useState)(""),[Z,B]=(0,l.useState)(!1),[P,W]=(0,l.useState)(null);(0,l.useEffect)(()=>{F()},[f,N,y,j]);let F=async()=>{try{let e=new URLSearchParams({page:f.toString(),limit:"20",...N&&{status:N},...y&&{marketplace:y},...j&&{search:j}}),a=await c.h.get("".concat(C?"/client/orders-history":"/client/orders","?").concat(e));s(a.data.orders),_(a.data.pagination.totalPages),D(a.data.pagination.total)}catch(e){console.error("Error fetching orders:",e)}finally{u(!1)}},T=async()=>{if(!E.trim()){o.default.error("Введите номер заказа");return}console.log("\uD83D\uDD0D Начинаем проверку заказа:",E.trim()),B(!0);try{console.log("\uD83D\uDCE1 Отправляем запрос на сервер...");let e=await c.h.get("/client/orders/check/".concat(E.trim()));console.log("✅ Ответ сервера получен:",e.data),W(e.data),R(!1),o.default.success("Информация о заказе получена")}catch(r){var e,s,a,t,l;console.error("❌ Ошибка при проверке заказа:",r),console.error("\uD83D\uDCC4 Детали ошибки:",{message:r.message,response:null===(e=r.response)||void 0===e?void 0:e.data,status:null===(s=r.response)||void 0===s?void 0:s.status,statusText:null===(a=r.response)||void 0===a?void 0:a.statusText}),o.default.error((null===(l=r.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.error)||"Заказ не найден"),W(null)}finally{B(!1),console.log("\uD83C\uDFC1 Проверка заказа завершена")}},z=e=>{let s={new:{label:"Новый",className:"badge-info"},in_assembly:{label:"В сборке",className:"badge-warning"},ready_to_ship:{label:"Готов к отправке",className:"badge-warning"},shipped:{label:"Отправлен",className:"badge-success"},delivered:{label:"Доставлен",className:"badge-success"},cancelled:{label:"Отменен",className:"badge-danger"}}[e]||{label:e,className:"badge-gray"};return(0,t.jsx)("span",{className:"badge ".concat(s.className),children:s.label})},q=e=>({wildberries:"Wildberries",ozon:"Ozon",yandex_market:"Яндекс.Маркет"})[e]||e,O=e=>{let s={FBS:{label:"FBS",className:"badge-primary",description:"Fulfillment by Seller"},DBW:{label:"DBW",className:"badge-success",description:"Delivery by Wildberries"},DBS:{label:"DBS",className:"badge-warning",description:"Delivery by Seller"}}[e]||{label:e,className:"badge-gray",description:""};return(0,t.jsx)("span",{className:"badge ".concat(s.className),title:s.description,children:s.label})},K=e=>e.supplierStatus||e.wbStatus?(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[e.supplierStatus&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Статус сборки:"})," ",{new:"Новое сборочное задание",confirm:"На сборке",complete:"В доставке",cancel:"Отменено продавцом"}[e.supplierStatus]||e.supplierStatus]}),e.wbStatus&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Статус WB:"})," ",{waiting:"В работе",sorted:"Отсортировано",sold:"Получен покупателем",canceled:"Отменено",canceled_by_client:"Отменено покупателем при получении",declined_by_client:"Отменено покупателем",defect:"Отмена по причине брака",ready_for_pickup:"Прибыло на ПВЗ"}[e.wbStatus]||e.wbStatus]})]}):null;return a?(0,t.jsx)(r.Z,{requiredRole:"client",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):(0,t.jsx)(r.Z,{requiredRole:"client",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Заказы"}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["Управление заказами с маркетплейсов",k>0&&(0,t.jsxs)("span",{className:"ml-2 text-primary-600 font-medium",children:["(",k," заказов)"]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsxs)("button",{onClick:()=>R(!0),className:"btn-secondary flex items-center",children:[(0,t.jsx)(i.Z,{className:"h-4 w-4 mr-2"}),"Проверить заказ"]}),(0,t.jsx)("button",{onClick:()=>{U(e=>!e),w(1),b(C?"new":""),u(!0)},className:"btn-primary",children:C?"Только новые":"Исторические данные"})]})]}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("form",{onSubmit:e=>{e.preventDefault(),w(1),F()},className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Поиск"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"text",value:j,onChange:e=>g(e.target.value),className:"input pl-10",placeholder:"Поиск по заказу или клиенту"}),(0,t.jsx)(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Маркетплейс"}),(0,t.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"input",children:[(0,t.jsx)("option",{value:"",children:"Все маркетплейсы"}),(0,t.jsx)("option",{value:"wildberries",children:"Wildberries"}),(0,t.jsx)("option",{value:"ozon",children:"Ozon"}),(0,t.jsx)("option",{value:"yandex_market",children:"Яндекс.Маркет"})]})]}),(0,t.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,t.jsxs)("button",{type:"submit",className:"btn-primary",children:[(0,t.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Найти"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{g(""),b(""),v(""),w(1)},className:"btn-secondary",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Сбросить"]})]})]})})})}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:e.length>0?(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["#",e.marketplace_order_id]}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:q(e.marketplace)}),e.order_type&&O(e.order_type),z(e.status)]}),K(e),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ru-RU")})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Клиент:"})," ",e.customer_name]}),e.customer_phone&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Телефон:"})," ",e.customer_phone]}),e.customer_email&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Email:"})," ",e.customer_email]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:(0,t.jsx)("span",{className:"font-medium",children:"Адрес доставки:"})}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.delivery_address})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Товары:"}),(0,t.jsx)("div",{className:"space-y-3",children:e.items.map((e,s)=>(0,t.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.article}),e.assignmentId&&(0,t.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["ID: ",e.assignmentId]}),e.orderType&&(0,t.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:e.orderType})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),e.subject&&e.subject!==e.name&&(0,t.jsxs)("div",{className:"text-gray-600",children:["Категория: ",e.subject]}),e.brand&&(0,t.jsxs)("div",{className:"text-gray-600",children:["Бренд: ",e.brand]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsxs)("span",{className:"text-gray-600",children:[e.quantity," шт. \xd7 ",e.priceFormatted||e.price.toLocaleString("ru-RU")," ₽"]})}),(0,t.jsxs)("div",{className:"font-medium text-gray-900",children:["= ",e.totalPriceFormatted||e.totalPrice.toLocaleString("ru-RU")," ₽"]})]})]}),(e.nmId||e.chrtId||e.orderUid||e.rid)&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[e.nmId&&(0,t.jsxs)("div",{children:["nmId: ",e.nmId]}),e.chrtId&&(0,t.jsxs)("div",{children:["chrtId: ",e.chrtId]}),e.orderUid&&(0,t.jsxs)("div",{children:["orderUid: ",e.orderUid]}),e.rid&&(0,t.jsxs)("div",{children:["rid: ",e.rid]}),e.skus&&e.skus.length>0&&(0,t.jsxs)("div",{children:["SKU: ",e.skus.join(", ")]})]})}),(e.supplierStatus||e.wbStatus)&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"text-xs space-y-1",children:[e.supplierStatus&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Статус сборки:"}),(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("new"===e.supplierStatus?"bg-blue-100 text-blue-800":"confirm"===e.supplierStatus?"bg-yellow-100 text-yellow-800":"complete"===e.supplierStatus?"bg-green-100 text-green-800":"cancel"===e.supplierStatus?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.supplierStatusText||e.supplierStatus})]}),e.wbStatus&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Статус WB:"}),(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("waiting"===e.wbStatus?"bg-yellow-100 text-yellow-800":"sorted"===e.wbStatus?"bg-blue-100 text-blue-800":"sold"===e.wbStatus?"bg-green-100 text-green-800":"ready_for_pickup"===e.wbStatus?"bg-green-100 text-green-800":e.wbStatus.includes("cancel")?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.wbStatusText||e.wbStatus})]})]})})]},s))})]})]},e.id))}):(0,t.jsxs)("div",{className:"text-center py-6",children:[(0,t.jsx)(m.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Нет заказов"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Заказы появятся здесь после настройки API ключей и импорта с маркетплейсов."}),(0,t.jsx)("div",{className:"mt-4"})]})})}),S>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-700",children:["Страница ",f," из ",S]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>w(e=>Math.max(e-1,1)),disabled:1===f,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Предыдущая"}),(0,t.jsx)("button",{onClick:()=>w(e=>Math.min(e+1,S)),disabled:f===S,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Следующая"})]})]}),I&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Проверить заказ"}),(0,t.jsx)("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(x.Z,{className:"h-6 w-6"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Номер заказа"}),(0,t.jsx)("input",{type:"text",value:E,onChange:e=>L(e.target.value),className:"input w-full",placeholder:"Введите номер заказа",onKeyPress:e=>"Enter"===e.key&&T()})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)("button",{onClick:T,disabled:Z,className:"btn-primary flex-1",children:Z?"Поиск...":"Найти заказ"}),(0,t.jsx)("button",{onClick:()=>R(!1),className:"btn-secondary",children:"Отмена"})]})]})]})}),P&&(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Детали заказа #",P.marketplace_order_id]}),(0,t.jsx)("button",{onClick:()=>W(null),className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(x.Z,{className:"h-6 w-6"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Маркетплейс:"})," ",q(P.marketplace)]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Статус:"})," ",z(P.status)]}),P.order_type&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Тип заказа:"})," ",O(P.order_type)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Сумма:"})," ",P.total_amount.toLocaleString("ru-RU")," ₽"]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Дата создания:"})," ",new Date(P.created_at).toLocaleDateString("ru-RU")]}),P.updated_at!==P.created_at&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Обновлен:"})," ",new Date(P.updated_at).toLocaleDateString("ru-RU")]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Клиент:"})," ",P.customer_name]}),P.customer_phone&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Телефон:"})," ",P.customer_phone]}),P.customer_email&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Email:"})," ",P.customer_email]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:(0,t.jsx)("span",{className:"font-medium",children:"Адрес доставки:"})}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:P.delivery_address})]}),P.supplierStatus&&P.wbStatus&&(0,t.jsx)("div",{children:K(P)}),P.items&&P.items.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Товары:"}),(0,t.jsx)("div",{className:"space-y-2",children:P.items.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.article}),(0,t.jsxs)("span",{className:"text-gray-500 ml-2",children:["- ",e.name]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:[e.quantity," шт. \xd7 ",e.price.toLocaleString("ru-RU")," ₽"]}),(0,t.jsxs)("span",{className:"font-medium ml-2",children:["= ",e.totalPrice.toLocaleString("ru-RU")," ₽"]})]})]},s))})]})]})]})})]})})}}},function(e){e.O(0,[737,251,869,133,971,938,744],function(){return e(e.s=7463)}),_N_E=e.O()}]);