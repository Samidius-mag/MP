(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{2600:function(e,t,s){Promise.resolve().then(s.bind(s,4733))},4733:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),a=s(4133),l=s(2265),i=s(826),n=s(5925),c=s(5255),d=s(4020);function o(){let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)([]),[o,x]=(0,l.useState)(!1),[m,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)(""),[g,y]=(0,l.useState)(null),[b,v]=(0,l.useState)("none"),[f,j]=(0,l.useState)("asc"),[N,w]=(0,l.useState)(10),[_,k]=(0,l.useState)(1);(0,l.useEffect)(()=>{C()},[]),(0,l.useEffect)(()=>{S()},[e,p,g,b,f]);let C=async()=>{try{x(!0);let e=(await i.h.get("/client/store-products")).data.products||[];t(e)}catch(t){var e,s;console.error("Error fetching products:",t),n.default.error((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)||"Ошибка загрузки товаров")}finally{x(!1)}},S=()=>{let t=[...e];p&&(t=t.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.article.toLowerCase().includes(p.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(p.toLowerCase()))),null!==g&&(t=t.filter(e=>e.is_active===g)),"none"!==b&&t.sort((e,t)=>{let s,r;switch(b){case"name":s=e.name||"",r=t.name||"";break;case"brand":s=e.brand||"",r=t.brand||"";break;case"price":s=Number(e.current_price)||0,r=Number(t.current_price)||0;break;default:return 0}return"string"==typeof s?"asc"===f?s.localeCompare(r):r.localeCompare(s):(isNaN(s)&&(s=0),isNaN(r)&&(r=0),"asc"===f?s-r:r-s)}),a(t),k(1)},M=async()=>{var e,t,s;try{u(!0);let t=await i.h.post("/client/store-products/load");n.default.success(t.data.message||"Загружено ".concat((null===(e=t.data.products)||void 0===e?void 0:e.length)||0," товаров")),await C()}catch(e){console.error("Error loading cards:",e),n.default.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Ошибка загрузки карточек")}finally{u(!1)}},E=e=>e?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e):"—",L=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return o?(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),(0,r.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsx)("div",{className:"h-24 bg-gray-200 rounded"},t))})]})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Товары магазина"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Просмотр и управление товарами Wildberries"})]}),(0,r.jsxs)("button",{onClick:M,disabled:m,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),m?"Загрузка...":"Загрузить карточки"]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(d.Z,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{type:"text",placeholder:"Поиск по названию, артикулу...",value:p,onChange:e=>h(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]}),(0,r.jsxs)("select",{value:null===g?"all":g?"active":"inactive",onChange:e=>{let t=e.target.value;y("all"===t?null:"active"===t)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"all",children:"Все"}),(0,r.jsx)("option",{value:"active",children:"Активные"}),(0,r.jsx)("option",{value:"inactive",children:"Неактивные"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"Сортировка:"}),(0,r.jsxs)("select",{value:b,onChange:e=>v(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"none",children:"Без сортировки"}),(0,r.jsx)("option",{value:"name",children:"По названию"}),(0,r.jsx)("option",{value:"brand",children:"По бренду"}),(0,r.jsx)("option",{value:"price",children:"По цене"})]}),"none"!==b&&(0,r.jsx)("button",{onClick:()=>j("asc"===f?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm",title:"asc"===f?"По возрастанию":"По убыванию",children:"asc"===f?"↑":"↓"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"Товаров на странице:"}),(0,r.jsxs)("select",{value:N,onChange:e=>{w(Number(e.target.value)),k(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"10",children:"10"}),(0,r.jsx)("option",{value:"25",children:"25"}),(0,r.jsx)("option",{value:"50",children:"50"}),(0,r.jsx)("option",{value:"100",children:"100"})]})]})]})]}),0===s.length?(0,r.jsx)("div",{className:"card text-center",children:(0,r.jsx)("div",{className:"py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:'Товары не найдены. Нажмите "Загрузить карточки" для импорта товаров из Wildberries.'})})}):(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Товар"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Артикул / nmId"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Цена"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Комиссия"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Логистика"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Статус"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Обновлено"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice((_-1)*N,_*N).map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.brand&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.brand}),e.category&&(0,r.jsx)("div",{className:"text-xs text-gray-400",children:e.category})]})}),(0,r.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap",children:[(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.article}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["nmId: ",e.nm_id]})]}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:E(e.current_price)}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.commission_percent?"".concat(e.commission_percent,"%"):"—"}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:E(e.logistics_cost)}),(0,r.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Активен":"Неактивен"}),e.in_promotion&&(0,r.jsxs)("div",{className:"text-xs text-purple-600 mt-1",children:["В акции: ",e.promotion_discount_percent,"%"]})]}),(0,r.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-xs text-gray-500",children:L(e.last_updated)})]},e.id))})]})}),Math.ceil(s.length/N)>1&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:["Показано ",(_-1)*N+1," - ",Math.min(_*N,s.length)," из ",s.length]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>k(Math.max(1,_-1)),disabled:1===_,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),(0,r.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(s.length/N))},(e,t)=>{let a;let l=Math.ceil(s.length/N);return a=l<=5?t+1:_<=3?t+1:_>=l-2?l-4+t:_-2+t,(0,r.jsx)("button",{onClick:()=>k(a),className:"px-3 py-1 text-sm font-medium rounded-md ".concat(_===a?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:a},a)})}),(0,r.jsx)("button",{onClick:()=>k(Math.min(Math.ceil(s.length/N),_+1)),disabled:_>=Math.ceil(s.length/N),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]})]}),s.length>0&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-sm text-blue-600 font-medium",children:"Всего товаров"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:s.length})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Активных"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-green-900",children:s.filter(e=>e.is_active).length})]}),(0,r.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-sm text-purple-600 font-medium",children:"В акциях"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:s.filter(e=>e.in_promotion).length})]}),(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-sm text-orange-600 font-medium",children:"Средняя цена"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:E(s.reduce((e,t)=>e+(t.current_price||0),0)/s.length)})]})]})]})}function x(){return(0,r.jsx)(a.Z,{requiredRole:"client",children:(0,r.jsx)(o,{})})}}},function(e){e.O(0,[737,251,783,133,971,938,744],function(){return e(e.s=2600)}),_N_E=e.O()}]);