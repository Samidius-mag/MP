(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{2694:function(e,s,r){Promise.resolve().then(r.bind(r,3590))},3590:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return u}});var a=r(7437),t=r(4133),l=r(2265),n=r(826),d=r(5925),i=r(5255),c=r(4020),o=r(3524);function m(){let[e,s]=(0,l.useState)([]),[r,t]=(0,l.useState)([]),[m,u]=(0,l.useState)(!1),[x,h]=(0,l.useState)(!1),[g,p]=(0,l.useState)(""),[b,v]=(0,l.useState)("none"),[y,f]=(0,l.useState)("asc"),[j,N]=(0,l.useState)(10),[w,C]=(0,l.useState)(1),[_,k]=(0,l.useState)(!1);(0,l.useEffect)(()=>{S(),E()},[]),(0,l.useEffect)(()=>{L()},[e,g,b,y]);let S=async()=>{try{var e,s;let r=await n.h.get("/client/api-keys"),a=null===(s=r.data.apiKeys)||void 0===s?void 0:null===(e=s.sima_land)||void 0===e?void 0:e.token;k(a&&""!==a.trim())}catch(e){console.error("Error checking token:",e),k(!1)}},E=async()=>{try{u(!0);let e=(await n.h.get("/client/sima-land/products")).data.products||[];s(e)}catch(s){var e,r,a,t,l;console.error("Error fetching products:",s),(null===(e=s.response)||void 0===e?void 0:e.status)===400?d.default.error((null===(a=s.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Необходимо настроить токен API"):d.default.error((null===(l=s.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.error)||"Ошибка загрузки товаров")}finally{u(!1)}},M=async()=>{var e,s,r;try{h(!0);let s=await n.h.post("/client/sima-land/products/load");d.default.success(s.data.message||"Загружено ".concat((null===(e=s.data.products)||void 0===e?void 0:e.length)||0," товаров")),await E()}catch(e){console.error("Error loading products:",e),d.default.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Ошибка загрузки товаров")}finally{h(!1)}},L=()=>{let s=[...e];g&&(s=s.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.article.toLowerCase().includes(g.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(g.toLowerCase()))),"none"!==b&&s.sort((e,s)=>{let r,a;switch(b){case"name":r=e.name||"",a=s.name||"";break;case"brand":r=e.brand||"",a=s.brand||"";break;case"price":r=Number(e.purchase_price)||0,a=Number(s.purchase_price)||0;break;default:return 0}return"string"==typeof r?"asc"===y?r.localeCompare(a):a.localeCompare(r):(isNaN(r)&&(r=0),isNaN(a)&&(a=0),"asc"===y?r-a:a-r)}),t(s),C(1)},Z=e=>e?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e):"—",q=async e=>{try{await n.h.post("/client/sima-land/products/add",{article:e.article,name:e.name,brand:e.brand,category:e.category,purchase_price:e.purchase_price,image_url:e.image_url}),d.default.success("Товар добавлен в магазин"),await E()}catch(e){var s,r;console.error("Error adding product:",e),d.default.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Ошибка добавления товара")}};return m?(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),(0,a.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"h-24 bg-gray-200 rounded"},s))})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Товары СИМА ЛЕНД"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Выберите товары поставщика для добавления в ваш магазин"})]}),(0,a.jsxs)("button",{onClick:M,disabled:x||!_,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),x?"Загрузка...":"Загрузить товары"]})]}),!_&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"Для работы с товарами СИМА ЛЕНД необходимо настроить токен API в разделе \xabНастройки\xbb."})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(c.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Поиск по названию, артикулу...",value:g,onChange:e=>p(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Сортировка:"}),(0,a.jsxs)("select",{value:b,onChange:e=>v(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"none",children:"Без сортировки"}),(0,a.jsx)("option",{value:"name",children:"По названию"}),(0,a.jsx)("option",{value:"brand",children:"По бренду"}),(0,a.jsx)("option",{value:"price",children:"По цене"})]}),"none"!==b&&(0,a.jsx)("button",{onClick:()=>f("asc"===y?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm",title:"asc"===y?"По возрастанию":"По убыванию",children:"asc"===y?"↑":"↓"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Товаров на странице:"}),(0,a.jsxs)("select",{value:j,onChange:e=>{N(Number(e.target.value)),C(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"10",children:"10"}),(0,a.jsx)("option",{value:"25",children:"25"}),(0,a.jsx)("option",{value:"50",children:"50"}),(0,a.jsx)("option",{value:"100",children:"100"})]})]})]})]}),0===r.length?(0,a.jsx)("div",{className:"card text-center",children:(0,a.jsxs)("div",{className:"py-12",children:[(0,a.jsx)(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("p",{className:"mt-4 text-gray-500",children:'Товары не найдены. Нажмите "Загрузить товары" для импорта товаров из СИМА ЛЕНД.'})]})}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.slice((w-1)*j,w*j).map(e=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"aspect-w-16 aspect-h-9 bg-gray-200",children:e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"w-full h-48 object-cover"}):(0,a.jsx)("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"h-12 w-12 text-gray-400"})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.name})}),e.brand&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.brand}),e.category&&(0,a.jsx)("p",{className:"text-xs text-blue-600 mb-2",children:e.category}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:Z(e.purchase_price)}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Остаток: ",e.available_quantity||0]})]}),(0,a.jsx)("button",{onClick:()=>q(e),className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Добавить"})]})]})]},e.id))}),Math.ceil(r.length/j)>1&&(0,a.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Показано ",(w-1)*j+1," - ",Math.min(w*j,r.length)," из ",r.length]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>C(Math.max(1,w-1)),disabled:1===w,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),(0,a.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(r.length/j))},(e,s)=>{let t;let l=Math.ceil(r.length/j);return t=l<=5?s+1:w<=3?s+1:w>=l-2?l-4+s:w-2+s,(0,a.jsx)("button",{onClick:()=>C(t),className:"px-3 py-1 text-sm font-medium rounded-md ".concat(w===t?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:t},t)})}),(0,a.jsx)("button",{onClick:()=>C(Math.min(Math.ceil(r.length/j),w+1)),disabled:w>=Math.ceil(r.length/j),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]}),r.length>0&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-blue-600 font-medium",children:"Всего товаров"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:r.length})]}),(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Доступно"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-900",children:r.filter(e=>(e.available_quantity||0)>0).length})]}),(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-sm text-orange-600 font-medium",children:"Средняя цена"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:Z(r.reduce((e,s)=>e+(s.purchase_price||0),0)/r.length)})]})]})]})}function u(){return(0,a.jsx)(t.Z,{requiredRole:"client",children:(0,a.jsx)(m,{})})}}},function(e){e.O(0,[737,251,348,133,971,938,744],function(){return e(e.s=2694)}),_N_E=e.O()}]);