(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{2694:function(e,r,a){Promise.resolve().then(a.bind(a,3590))},3590:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return m}});var t=a(7437),s=a(4133),l=a(2265),i=a(826),n=a(5925),c=a(4020),o=a(3524);function d(){let[e,r]=(0,l.useState)([]),[a,s]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[u,x]=(0,l.useState)([]),[g,h]=(0,l.useState)([]),[p,y]=(0,l.useState)(!1),[b,v]=(0,l.useState)(""),[f,N]=(0,l.useState)("none"),[j,w]=(0,l.useState)("asc"),[_,C]=(0,l.useState)(10),[k,E]=(0,l.useState)(1),[S,I]=(0,l.useState)(!1);(0,l.useEffect)(()=>{L(),T()},[]),(0,l.useEffect)(()=>{D()},[e,b,f,j]);let L=async()=>{try{var e,r;let a=await i.h.get("/client/api-keys"),t=null===(r=a.data.apiKeys)||void 0===r?void 0:null===(e=r.sima_land)||void 0===e?void 0:e.token;I(t&&""!==t.trim())}catch(e){console.error("Error checking token:",e),I(!1)}},T=async()=>{try{let e=await i.h.get("/client/sima-land/categories");x(e.data.categories||[])}catch(e){console.error("Error fetching categories:",e)}},q=async(e,a)=>{try{m(!0);let t={};e&&e.trim()&&(t.search=e.trim()),a&&a.length>0&&(t.categories=a);let s=(await i.h.get("/client/sima-land/products",{params:t})).data.products||[];s.length>0?(console.log("[CLIENT] ✅ Received products:",s.length),s.slice(0,3).forEach(e=>{var r;console.log("[CLIENT] Product ".concat(e.id," (").concat(e.article,"):")),console.log("[CLIENT]   image_url = ".concat(e.image_url||"NULL"," (type: ").concat(typeof e.image_url,")")),console.log("[CLIENT]   name = ".concat(null===(r=e.name)||void 0===r?void 0:r.substring(0,50),"...")),e.image_url&&console.log("[CLIENT]   \uD83D\uDD0D Will try to load image: ".concat(e.image_url))})):console.log("[CLIENT] ⚠️  No products received"),r(s)}catch(e){var t,s,l,c,o;console.error("Error fetching products:",e),(null===(t=e.response)||void 0===t?void 0:t.status)===400?n.default.error((null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.error)||"Необходимо настроить токен API"):n.default.error((null===(o=e.response)||void 0===o?void 0:null===(c=o.data)||void 0===c?void 0:c.error)||"Ошибка загрузки товаров")}finally{m(!1)}},M=e=>{h(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},D=()=>{let r=[...e];"none"!==f&&r.sort((e,r)=>{let a,t;switch(f){case"available":{let a=(Number(e.available_quantity)||0)>0?1:0,t=(Number(r.available_quantity)||0)>0?1:0;if(a!==t)return t-a;let s=Number(e.available_quantity)||0;return(Number(r.available_quantity)||0)-s}case"name":a=e.name||"",t=r.name||"";break;case"brand":a=e.brand||"",t=r.brand||"";break;case"price":a=Number(e.purchase_price)||0,t=Number(r.purchase_price)||0;break;default:return 0}return"string"==typeof a?"asc"===j?a.localeCompare(t):t.localeCompare(a):(isNaN(a)&&(a=0),isNaN(t)&&(t=0),"asc"===j?a-t:t-a)}),s(r),E(1)},Z=e=>e?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e):"—",R=async e=>{try{await i.h.post("/client/sima-land/products/add",{article:e.article,name:e.name,brand:e.brand,category:e.category,purchase_price:e.purchase_price,available_quantity:e.available_quantity||0,image_url:e.image_url,description:e.description}),n.default.success("Товар добавлен в магазин"),b&&b.trim().length>=2&&await q(b.trim())}catch(e){var r,a;console.error("Error adding product:",e),n.default.error((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Ошибка добавления товара")}};return d?(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,r)=>(0,t.jsx)("div",{className:"h-24 bg-gray-200 rounded"},r))})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Товары СИМА ЛЕНД"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Найдите товары поставщика по названию или артикулу"})]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center w-full max-w-xl ml-auto",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(c.Z,{className:"h-5 w-5 text-gray-400"})}),(0,t.jsx)("input",{type:"text",placeholder:"Поиск по названию или артикулу (или выберите категории)",value:b,onChange:e=>v(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]}),(0,t.jsx)("button",{onClick:()=>{let e=b.trim();if(!e&&0===g.length){(0,n.default)("Введите поисковый запрос или выберите категории",{icon:"ℹ️"}),r([]),s([]);return}q(e||"",g)},className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Применить"}),(0,t.jsxs)("button",{onClick:()=>y(!p),className:"px-4 py-2 text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ".concat(p||g.length>0?"bg-primary-100 text-primary-700 border border-primary-300":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"),children:["Категории ",g.length>0&&"(".concat(g.length,")")]})]})]}),p&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Фильтр по категориям"}),g.length>0&&(0,t.jsx)("button",{onClick:()=>{h([]),b.trim()?q(b.trim(),[]):(r([]),s([]))},className:"text-sm text-primary-600 hover:text-primary-700",children:"Очистить"})]}),0===u.length?(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Категории загружаются..."}):(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:u.map(e=>(0,t.jsxs)("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:g.includes(e.id),onChange:()=>M(e.id),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.id))}),g.length>0&&(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-500 mb-2",children:["Выбрано категорий: ",g.length]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(e=>{let r=u.find(r=>r.id===e);return r?(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:[r.name,(0,t.jsx)("button",{onClick:()=>M(e),className:"ml-1 text-primary-600 hover:text-primary-800",children:"\xd7"})]},e):null})})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"Сортировка:"}),(0,t.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"none",children:"Без сортировки"}),(0,t.jsx)("option",{value:"available",children:"Доступные первыми"}),(0,t.jsx)("option",{value:"name",children:"По названию"}),(0,t.jsx)("option",{value:"brand",children:"По бренду"}),(0,t.jsx)("option",{value:"price",children:"По цене"})]}),"none"!==f&&(0,t.jsx)("button",{onClick:()=>w("asc"===j?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm",title:"asc"===j?"По возрастанию":"По убыванию",children:"asc"===j?"↑":"↓"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"Товаров на странице:"}),(0,t.jsxs)("select",{value:_,onChange:e=>{C(Number(e.target.value)),E(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"10",children:"10"}),(0,t.jsx)("option",{value:"25",children:"25"}),(0,t.jsx)("option",{value:"50",children:"50"}),(0,t.jsx)("option",{value:"100",children:"100"})]})]})]})}),0===a.length?(0,t.jsx)("div",{className:"card text-center",children:(0,t.jsxs)("div",{className:"py-12",children:[(0,t.jsx)(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),b||0!==g.length?(0,t.jsx)("p",{className:"mt-4 text-gray-500",children:"Товары не найдены для выбранных фильтров."}):(0,t.jsx)("p",{className:"mt-4 text-gray-500",children:"Введите поисковый запрос или выберите категории для фильтрации товаров."})]})}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.slice((k-1)*_,k*_).map(e=>(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"aspect-w-16 aspect-h-9 bg-gray-200",children:[e.image_url?(0,t.jsx)("img",{src:e.image_url,alt:e.name,className:"w-full h-48 object-cover",onError:r=>{var a;console.error("[CLIENT] Failed to load image for product ".concat(e.id,":"),e.image_url),console.error("[CLIENT] Error details:",r),r.currentTarget.style.display="none";let t=null===(a=r.currentTarget.parentElement)||void 0===a?void 0:a.querySelector(".image-placeholder");t&&(t.style.display="flex")},onLoad:()=>{console.log("[CLIENT] ✅ Image loaded successfully for product ".concat(e.id,":"),e.image_url)}}):(0,t.jsxs)("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center image-placeholder",children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 text-gray-400"}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"Нет изображения"})]}),e.image_url&&(0,t.jsxs)("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center image-placeholder",style:{display:"none"},children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 text-gray-400"}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"Ошибка загрузки"})]})]}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.name})}),e.brand&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.brand}),e.category&&(0,t.jsx)("p",{className:"text-xs text-blue-600 mb-2",children:e.category}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:Z(e.purchase_price)}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Остаток: ",e.available_quantity||0]})]}),(0,t.jsx)("button",{onClick:()=>R(e),className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Добавить"})]})]})]},e.id))}),Math.ceil(a.length/_)>1&&(0,t.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-700",children:["Показано ",(k-1)*_+1," - ",Math.min(k*_,a.length)," из ",a.length]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>E(Math.max(1,k-1)),disabled:1===k,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),(0,t.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(a.length/_))},(e,r)=>{let s;let l=Math.ceil(a.length/_);return s=l<=5?r+1:k<=3?r+1:k>=l-2?l-4+r:k-2+r,(0,t.jsx)("button",{onClick:()=>E(s),className:"px-3 py-1 text-sm font-medium rounded-md ".concat(k===s?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:s},s)})}),(0,t.jsx)("button",{onClick:()=>E(Math.min(Math.ceil(a.length/_),k+1)),disabled:k>=Math.ceil(a.length/_),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]}),a.length>0&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-blue-600 font-medium",children:"Всего товаров"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:a.length})]}),(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Доступно"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-900",children:a.filter(e=>(e.available_quantity||0)>0).length})]}),(0,t.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-orange-600 font-medium",children:"Средняя цена"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:Z(a.reduce((e,r)=>e+(r.purchase_price||0),0)/a.length)})]})]})]})}function m(){return(0,t.jsx)(s.Z,{requiredRole:"client",children:(0,t.jsx)(d,{})})}}},function(e){e.O(0,[737,251,991,133,971,938,744],function(){return e(e.s=2694)}),_N_E=e.O()}]);