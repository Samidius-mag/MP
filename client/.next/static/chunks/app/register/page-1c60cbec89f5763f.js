(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{2231:function(e,t,s){Promise.resolve().then(s.bind(s,78))},78:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var r=s(7437),a=s(9438),n=s(4033),o=s(2265),l=s(1865),i=s(5925),c=s(1396),d=s.n(c);function u(e){let{content:t}=e;return(0,r.jsxs)("div",{className:"group relative inline-block",children:[(0,r.jsx)("span",{className:"text-gray-400 hover:text-gray-600 cursor-help",children:"?"}),(0,r.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10",children:[t,(0,r.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]})}function m(){let[e,t]=(0,o.useState)(!1),[s,n]=(0,o.useState)(!1),[c,m]=(0,o.useState)(null),{register:h,checkCompany:p}=(0,a.useAuth)(),{register:x,handleSubmit:f,watch:v,formState:{errors:g},setValue:j}=(0,l.cI)(),w=v("password"),b=v("inn"),y=async e=>{if(e&&!(e.length<10)){n(!0);try{let t=await p(e);m(t.data),i.default.success("Компания найдена и проверена")}catch(t){m({inn:e,name:"Компания с ИНН ".concat(e),form:10===e.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:t.message||"Ошибка проверки через ФНС"}}),(0,i.default)("Ошибка проверки ФНС, но регистрация возможна",{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e",border:"1px solid #f59e0b"}})}finally{n(!1)}}};o.useEffect(()=>{let e=setTimeout(()=>{b&&b.length>=10&&y(b)},1e3);return()=>clearTimeout(e)},[b]);let N=async e=>{if(e.password!==e.confirmPassword){i.default.error("Пароли не совпадают");return}c||m({inn:e.inn,name:"Компания с ИНН ".concat(e.inn),form:10===e.inn.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:"Компания не проверена через ФНС"}}),t(!0);try{await h({...e,companyData:c,termsAccepted:e.termsAccepted}),i.default.success("Регистрация выполнена успешно"),window.location.href="/client/dashboard"}catch(e){i.default.error(e.message||"Ошибка регистрации")}finally{t(!1)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("form",{className:"space-y-6",onSubmit:f(N),children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"firstName",className:"label flex items-center gap-2",children:["Имя *",(0,r.jsx)(u,{content:"Введите ваше имя"})]}),(0,r.jsx)("input",{...x("firstName",{required:"Имя обязательно"}),type:"text",className:"input ".concat(g.firstName?"input-error":""),placeholder:"Введите ваше имя",autoComplete:"off"}),g.firstName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.firstName.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"lastName",className:"label flex items-center gap-2",children:["Фамилия *",(0,r.jsx)(u,{content:"Введите вашу фамилию"})]}),(0,r.jsx)("input",{...x("lastName",{required:"Фамилия обязательна"}),type:"text",className:"input ".concat(g.lastName?"input-error":""),placeholder:"Введите вашу фамилию",autoComplete:"off"}),g.lastName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.lastName.message})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"email",className:"label flex items-center gap-2",children:["Email *",(0,r.jsx)(u,{content:"Ваш email для входа"})]}),(0,r.jsx)("input",{...x("email",{required:"Email обязателен",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Неверный формат email"}}),type:"email",className:"input ".concat(g.email?"input-error":""),placeholder:"Введите ваш email",autoComplete:"off"}),g.email&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"phone",className:"label flex items-center gap-2",children:["Телефон *",(0,r.jsx)(u,{content:"Ваш контактный номер телефона"})]}),(0,r.jsx)("input",{...x("phone",{required:"Телефон обязателен",pattern:{value:/^[\+]?[1-9][\d]{0,15}$/,message:"Неверный формат телефона"}}),type:"tel",className:"input ".concat(g.phone?"input-error":""),placeholder:"+7 (999) 123-45-67",autoComplete:"off"}),g.phone&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.phone.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"inn",className:"label flex items-center gap-2",children:["ИНН компании *",(0,r.jsx)(u,{content:"Введите ИНН вашей компании. Данные будут автоматически получены из базы ФНС"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{...x("inn",{required:"ИНН обязателен",pattern:{value:/^\d{10,12}$/,message:"ИНН должен содержать 10-12 цифр"}}),type:"text",className:"input pr-10 ".concat(g.inn?"input-error":""),placeholder:"1234567890",autoComplete:"off"}),s&&(0,r.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),g.inn&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.inn.message})]}),c&&(0,r.jsxs)("div",{className:"p-4 rounded-lg border ".concat(c.status&&!c.status.includes("Не проверено")?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:c.status&&!c.status.includes("Не проверено")?"text-green-600":"text-yellow-600",children:c.status&&!c.status.includes("Не проверено")?"✓":"⚠"}),(0,r.jsx)("h3",{className:"font-medium ".concat(c.status&&!c.status.includes("Не проверено")?"text-green-800":"text-yellow-800"),children:c.status&&!c.status.includes("Не проверено")?"Компания найдена и проверена":"Компания не проверена в ФНС"})]}),(0,r.jsxs)("div",{className:"text-sm space-y-1 ".concat(c.status&&!c.status.includes("Не проверено")?"text-green-700":"text-yellow-700"),children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Название:"})," ",c.name]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Форма:"})," ","OOO"===c.form?"ООО":"ИП"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"ИНН:"})," ",c.inn]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"ОГРН:"})," ",c.ogrn||"Не указан"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Статус:"})," ",c.status]}),c.reliability&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Надежность:"})," ",c.reliability.message]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"password",className:"label flex items-center gap-2",children:["Пароль *",(0,r.jsx)(u,{content:"Минимум 8 символов, 1 заглавная буква, 1 спецсимвол. Пример: HgyE#8"})]}),(0,r.jsx)("input",{...x("password",{required:"Пароль обязателен",minLength:{value:8,message:"Пароль должен содержать минимум 8 символов"},pattern:{value:/^(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/,message:"Пароль должен содержать минимум 8 символов, 1 заглавную букву и 1 спецсимвол"}}),type:"password",className:"input ".concat(g.password?"input-error":""),placeholder:"Введите пароль",autoComplete:"new-password"}),g.password&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.password.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"confirmPassword",className:"label flex items-center gap-2",children:["Подтверждение пароля *",(0,r.jsx)(u,{content:"Повторите пароль для подтверждения"})]}),(0,r.jsx)("input",{...x("confirmPassword",{required:"Подтверждение пароля обязательно",validate:e=>e===w||"Пароли не совпадают"}),type:"password",className:"input ".concat(g.confirmPassword?"input-error":""),placeholder:"Подтвердите пароль",autoComplete:"new-password"}),g.confirmPassword&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.confirmPassword.message})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex items-center h-5",children:(0,r.jsx)("input",{...x("termsAccepted",{required:"Необходимо согласие с офертой"}),type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),(0,r.jsxs)("div",{className:"ml-3 text-sm",children:[(0,r.jsxs)("label",{htmlFor:"termsAccepted",className:"font-medium text-gray-700",children:["Я согласен с"," ",(0,r.jsx)("a",{href:"/terms",className:"text-blue-600 hover:text-blue-500 underline",children:"условиями оферты"})," ","и"," ",(0,r.jsx)("a",{href:"/privacy",className:"text-blue-600 hover:text-blue-500 underline",children:"политикой конфиденциальности"}),"*"]}),g.termsAccepted&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.termsAccepted.message})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:e,className:"btn-primary w-full",children:e?"Регистрация...":"Зарегистрироваться"})})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Или"})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(d(),{href:"/login",className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Уже есть аккаунт? Войти"})})]})]})}function h(){let{user:e,loading:t}=(0,a.useAuth)(),s=(0,n.useRouter)();return((0,o.useEffect)(()=>{if(!t&&e)switch(e.role){case"client":s.push("/client/dashboard");break;case"operator":s.push("/operator/dashboard");break;case"admin":s.push("/admin")}},[e,t,s]),t||e)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Регистрация"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Создайте новый аккаунт"})]})}),(0,r.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,r.jsx)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:(0,r.jsx)(m,{})})})]})}},826:function(e,t,s){"use strict";s.d(t,{h:function(){return r}});let r=s(4829).Z.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:6e4});r.interceptors.response.use(e=>e,e=>{var t,s;return((null===(t=e.response)||void 0===t?void 0:t.status)===401||(null===(s=e.response)||void 0===s?void 0:s.status)===403)&&(localStorage.removeItem("token"),delete r.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e)}),r.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e))},9438:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return c},useAuth:function(){return d}});var r=s(7437),a=s(2265),n=s(826);class o{async sendLog(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isEnabled)try{await n.h.post("/admin/logs/client",{level:e,message:t,component:s.component,action:s.action,url:s.url||window.location.href,metadata:s.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,t){console.error("[CLIENT ERROR] ".concat(e),t),this.sendLog("error",e,t)}warn(e,t){console.warn("[CLIENT WARN] ".concat(e),t),this.sendLog("warn",e,t)}info(e,t){console.info("[CLIENT INFO] ".concat(e),t),this.sendLog("info",e,t)}debug(e,t){console.debug("[CLIENT DEBUG] ".concat(e),t),this.sendLog("debug",e,t)}userAction(e,t,s){this.info("User action: ".concat(e),{component:t,action:e,metadata:s})}apiError(e,t,s){var r;this.error("API Error: ".concat(e),{component:"API",action:"request",metadata:{endpoint:e,error:(null==t?void 0:t.message)||t,status:null==t?void 0:null===(r=t.response)||void 0===r?void 0:r.status,...s}})}navigation(e,t){this.info("Navigation: ".concat(e," -> ").concat(t),{component:"Router",action:"navigation",metadata:{from:e,to:t}})}componentError(e,t,s){this.error("Component Error: ".concat(e),{component:e,action:"render",metadata:{error:(null==t?void 0:t.message)||t,stack:null==t?void 0:t.stack,...s}})}constructor(){this.isEnabled=!0,this.isEnabled=!1}}let l=new o,i=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[s,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{u()},[]);let u=async()=>{let e=localStorage.getItem("token");if(!e){d(!1);return}n.h.defaults.headers.common.Authorization="Bearer ".concat(e);let t=0;for(;t<5;)try{let e=await n.h.get("/auth/profile");o(e.data),d(!1);return}catch(r){var s;let e=null==r?void 0:null===(s=r.response)||void 0===s?void 0:s.status;if(t++,401===e||403===e){localStorage.removeItem("token"),delete n.h.defaults.headers.common.Authorization,o(null),d(!1);return}await new Promise(e=>setTimeout(e,Math.min(5e3,500*t)))}d(!1)},m=async(e,t)=>{try{l.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:s,token:r,requiresTwoFactor:a,userId:i,requiresPasswordChange:c}=(await n.h.post("/auth/login",{email:e,password:t})).data;if(a)return{requiresTwoFactor:!0,userId:i};if(c)return{requiresPasswordChange:!0,userId:i};return localStorage.setItem("token",r),n.h.defaults.headers.common.Authorization="Bearer ".concat(r),o(s),l.info("Login successful",{component:"Auth",action:"login",metadata:{userId:s.id,email:e}}),{}}catch(o){var s,r,a;let t=null==o?void 0:null===(s=o.response)||void 0===s?void 0:s.status,n=null==o?void 0:null===(a=o.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error;throw l.apiError("/auth/login",o,{email:e}),Error(401===t?"Неверный email или пароль":500===t?"Ошибка сервера при входе":n||"Ошибка входа")}},h=async e=>{try{let{token:t,user:s}=(await n.h.post("/auth/register",e)).data;if(t&&s)return localStorage.setItem("token",t),n.h.defaults.headers.common.Authorization="Bearer ".concat(t),o(s),{token:t};return{}}catch(n){var t,s,r;let e=null==n?void 0:null===(t=n.response)||void 0===t?void 0:t.status,a=null==n?void 0:null===(r=n.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error;throw Error(409===e?"Пользователь с таким email уже существует":a||"Ошибка регистрации")}},p=async e=>{try{let t=await n.h.put("/auth/profile",e);o(e=>e?{...e,...t.data}:null)}catch(e){var t,s;throw Error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Ошибка обновления профиля")}},x=async(e,t)=>{try{let{token:s,user:r}=(await n.h.post("/auth/verify-2fa",{userId:e,code:t})).data;return localStorage.setItem("token",s),n.h.defaults.headers.common.Authorization="Bearer ".concat(s),o(r),s}catch(e){var s,r;throw Error((null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Ошибка подтверждения 2FA")}},f=async(e,t)=>{try{let{token:s,user:r}=(await n.h.post("/auth/verify-email",{userId:e,code:t})).data;return s&&(localStorage.setItem("token",s),n.h.defaults.headers.common.Authorization="Bearer ".concat(s),o(r)),s}catch(e){var s,r;throw Error((null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Ошибка подтверждения email")}},v=async(e,t)=>{try{await n.h.post("/auth/resend-code",{userId:e,type:t})}catch(e){var s,r;throw Error((null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Ошибка отправки кода")}},g=async e=>{try{return(await n.h.post("/auth/check-company",{inn:e})).data}catch(e){var t,s;throw Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Ошибка проверки компании")}},j=async(e,t,s)=>{try{await n.h.put("/auth/force-change-password",{userId:e,currentPassword:t,newPassword:s})}catch(e){var r,a;throw Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Ошибка смены пароля")}};return(0,r.jsx)(i.Provider,{value:{user:s,loading:c,login:m,register:h,logout:()=>{l.info("User logout",{component:"Auth",action:"logout",metadata:{userId:null==s?void 0:s.id}}),localStorage.removeItem("token"),delete n.h.defaults.headers.common.Authorization,o(null),window.location.href="/login"},updateProfile:p,verifyTwoFactor:x,verifyEmail:f,resendCode:v,checkCompany:g,forceChangePassword:j},children:t})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[737,251,279,971,938,744],function(){return e(e.s=2231)}),_N_E=e.O()}]);