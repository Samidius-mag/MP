(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{2231:function(e,t,s){Promise.resolve().then(s.bind(s,78))},78:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(7437),r=s(9438),l=s(4033),n=s(2265),o=s(1865),i=s(5925),c=s(1396),d=s.n(c);function u(e){let{userId:t,email:s,onComplete:l}=e,[o,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),{verifyEmail:x,resendCode:p}=(0,r.useAuth)(),f=async()=>{if(6!==o.length){i.default.error("Введите 6-значный код");return}h(!0);try{let e=await x(t,o);u(!0),e?l():i.default.success("Email подтвержден")}catch(e){i.default.error(e.message||"Ошибка подтверждения email")}finally{h(!1)}},g=async()=>{try{await p(t,"email"),i.default.success("Код отправлен повторно")}catch(e){i.default.error(e.message||"Ошибка отправки кода")}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Подтверждение регистрации"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Мы отправили код подтверждения на ваш email"})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg ".concat(d?"bg-green-50 border border-green-200":"bg-blue-50 border border-blue-200"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Email: ",s]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:d?"Подтвержден":"Введите код из письма"})]}),d?(0,a.jsx)("span",{className:"text-green-600",children:"✓"}):(0,a.jsx)("button",{onClick:g,className:"text-sm text-blue-600 hover:text-blue-800",children:"Отправить повторно"})]}),!d&&(0,a.jsxs)("div",{className:"mt-3 flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"flex-1 input text-center text-lg tracking-widest",maxLength:6}),(0,a.jsx)("button",{onClick:f,disabled:m||6!==o.length,className:"btn-primary px-4",children:m?"...":"Подтвердить"})]})]})]})}function m(e){let{content:t}=e;return(0,a.jsxs)("div",{className:"group relative inline-block",children:[(0,a.jsx)("span",{className:"text-gray-400 hover:text-gray-600 cursor-help",children:"?"}),(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10",children:[t,(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]})}function h(){let[e,t]=(0,n.useState)(!1),[s,l]=(0,n.useState)(!1),[c,h]=(0,n.useState)(null),[x,p]=(0,n.useState)("form"),[f,g]=(0,n.useState)(null),{register:v,checkCompany:j}=(0,r.useAuth)(),{register:b,handleSubmit:y,watch:N,formState:{errors:w},setValue:A}=(0,o.cI)(),E=N("password"),k=N("inn"),I=async e=>{if(e&&!(e.length<10)){l(!0);try{let t=await j(e);h(t.data),i.default.success("Компания найдена и проверена")}catch(t){h({inn:e,name:"Компания с ИНН ".concat(e),form:10===e.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:t.message||"Ошибка проверки через ФНС"}}),(0,i.default)("Ошибка проверки ФНС, но регистрация возможна",{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e",border:"1px solid #f59e0b"}})}finally{l(!1)}}};n.useEffect(()=>{let e=setTimeout(()=>{k&&k.length>=10&&I(k)},1e3);return()=>clearTimeout(e)},[k]);let C=async e=>{if(e.password!==e.confirmPassword){i.default.error("Пароли не совпадают");return}c||h({inn:e.inn,name:"Компания с ИНН ".concat(e.inn),form:10===e.inn.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:"Компания не проверена через ФНС"}}),t(!0);try{let t=await v({...e,companyData:c,termsAccepted:e.termsAccepted});g({userId:t.userId,email:t.email}),p("verification"),i.default.success("Проверьте email для подтверждения")}catch(e){i.default.error(e.message||"Ошибка регистрации")}finally{t(!1)}};return"verification"===x&&f?(0,a.jsx)(u,{userId:f.userId,email:f.email,onComplete:()=>{window.location.href="/client/dashboard"}}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("form",{className:"space-y-6",onSubmit:y(C),children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"firstName",className:"label flex items-center gap-2",children:["Имя *",(0,a.jsx)(m,{content:"Введите ваше имя"})]}),(0,a.jsx)("input",{...b("firstName",{required:"Имя обязательно"}),type:"text",className:"input ".concat(w.firstName?"input-error":""),placeholder:"Введите ваше имя",autoComplete:"off"}),w.firstName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.firstName.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"lastName",className:"label flex items-center gap-2",children:["Фамилия *",(0,a.jsx)(m,{content:"Введите вашу фамилию"})]}),(0,a.jsx)("input",{...b("lastName",{required:"Фамилия обязательна"}),type:"text",className:"input ".concat(w.lastName?"input-error":""),placeholder:"Введите вашу фамилию",autoComplete:"off"}),w.lastName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.lastName.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"email",className:"label flex items-center gap-2",children:["Email *",(0,a.jsx)(m,{content:"На этот email будет отправлен код подтверждения"})]}),(0,a.jsx)("input",{...b("email",{required:"Email обязателен",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Неверный формат email"}}),type:"email",className:"input ".concat(w.email?"input-error":""),placeholder:"Введите ваш email",autoComplete:"off"}),w.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.email.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"phone",className:"label flex items-center gap-2",children:["Телефон *",(0,a.jsx)(m,{content:"На этот номер будет отправлен SMS с кодом подтверждения"})]}),(0,a.jsx)("input",{...b("phone",{required:"Телефон обязателен",pattern:{value:/^[\+]?[1-9][\d]{0,15}$/,message:"Неверный формат телефона"}}),type:"tel",className:"input ".concat(w.phone?"input-error":""),placeholder:"+7 (999) 123-45-67",autoComplete:"off"}),w.phone&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.phone.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"inn",className:"label flex items-center gap-2",children:["ИНН компании *",(0,a.jsx)(m,{content:"Введите ИНН вашей компании. Данные будут автоматически получены из базы ФНС"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{...b("inn",{required:"ИНН обязателен",pattern:{value:/^\d{10,12}$/,message:"ИНН должен содержать 10-12 цифр"}}),type:"text",className:"input pr-10 ".concat(w.inn?"input-error":""),placeholder:"1234567890",autoComplete:"off"}),s&&(0,a.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),w.inn&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.inn.message})]}),c&&(0,a.jsxs)("div",{className:"p-4 rounded-lg border ".concat(c.status&&!c.status.includes("Не проверено")?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:c.status&&!c.status.includes("Не проверено")?"text-green-600":"text-yellow-600",children:c.status&&!c.status.includes("Не проверено")?"✓":"⚠"}),(0,a.jsx)("h3",{className:"font-medium ".concat(c.status&&!c.status.includes("Не проверено")?"text-green-800":"text-yellow-800"),children:c.status&&!c.status.includes("Не проверено")?"Компания найдена и проверена":"Компания не проверена в ФНС"})]}),(0,a.jsxs)("div",{className:"text-sm space-y-1 ".concat(c.status&&!c.status.includes("Не проверено")?"text-green-700":"text-yellow-700"),children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Название:"})," ",c.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Форма:"})," ","OOO"===c.form?"ООО":"ИП"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"ИНН:"})," ",c.inn]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"ОГРН:"})," ",c.ogrn||"Не указан"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Статус:"})," ",c.status]}),c.reliability&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Надежность:"})," ",c.reliability.message]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"password",className:"label flex items-center gap-2",children:["Пароль *",(0,a.jsx)(m,{content:"Минимум 8 символов, 1 заглавная буква, 1 спецсимвол. Пример: HgyE#8"})]}),(0,a.jsx)("input",{...b("password",{required:"Пароль обязателен",minLength:{value:8,message:"Пароль должен содержать минимум 8 символов"},pattern:{value:/^(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/,message:"Пароль должен содержать минимум 8 символов, 1 заглавную букву и 1 спецсимвол"}}),type:"password",className:"input ".concat(w.password?"input-error":""),placeholder:"Введите пароль",autoComplete:"new-password"}),w.password&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.password.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"confirmPassword",className:"label flex items-center gap-2",children:["Подтверждение пароля *",(0,a.jsx)(m,{content:"Повторите пароль для подтверждения"})]}),(0,a.jsx)("input",{...b("confirmPassword",{required:"Подтверждение пароля обязательно",validate:e=>e===E||"Пароли не совпадают"}),type:"password",className:"input ".concat(w.confirmPassword?"input-error":""),placeholder:"Подтвердите пароль",autoComplete:"new-password"}),w.confirmPassword&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.confirmPassword.message})]}),(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex items-center h-5",children:(0,a.jsx)("input",{...b("termsAccepted",{required:"Необходимо согласие с офертой"}),type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),(0,a.jsxs)("div",{className:"ml-3 text-sm",children:[(0,a.jsxs)("label",{htmlFor:"termsAccepted",className:"font-medium text-gray-700",children:["Я согласен с"," ",(0,a.jsx)("a",{href:"/terms",className:"text-blue-600 hover:text-blue-500 underline",children:"условиями оферты"})," ","и"," ",(0,a.jsx)("a",{href:"/privacy",className:"text-blue-600 hover:text-blue-500 underline",children:"политикой конфиденциальности"}),"*"]}),w.termsAccepted&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.termsAccepted.message})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:e,className:"btn-primary w-full",children:e?"Регистрация...":"Зарегистрироваться"})})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Или"})})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(d(),{href:"/login",className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Уже есть аккаунт? Войти"})})]})]})}function x(){let{user:e,loading:t}=(0,r.useAuth)(),s=(0,l.useRouter)();return((0,n.useEffect)(()=>{if(!t&&e)switch(e.role){case"client":s.push("/client/dashboard");break;case"operator":s.push("/operator/dashboard");break;case"admin":s.push("/admin")}},[e,t,s]),t||e)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Регистрация"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Создайте новый аккаунт"})]})}),(0,a.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsx)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:(0,a.jsx)(h,{})})})]})}},826:function(e,t,s){"use strict";s.d(t,{h:function(){return a}});let a=s(4829).Z.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});a.interceptors.response.use(e=>e,e=>{var t,s;return((null===(t=e.response)||void 0===t?void 0:t.status)===401||(null===(s=e.response)||void 0===s?void 0:s.status)===403)&&(localStorage.removeItem("token"),delete a.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e)}),a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e))},9438:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return c},useAuth:function(){return d}});var a=s(7437),r=s(2265),l=s(826);class n{async sendLog(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isEnabled)try{await l.h.post("/admin/logs/client",{level:e,message:t,component:s.component,action:s.action,url:s.url||window.location.href,metadata:s.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,t){console.error("[CLIENT ERROR] ".concat(e),t),this.sendLog("error",e,t)}warn(e,t){console.warn("[CLIENT WARN] ".concat(e),t),this.sendLog("warn",e,t)}info(e,t){console.info("[CLIENT INFO] ".concat(e),t),this.sendLog("info",e,t)}debug(e,t){console.debug("[CLIENT DEBUG] ".concat(e),t),this.sendLog("debug",e,t)}userAction(e,t,s){this.info("User action: ".concat(e),{component:t,action:e,metadata:s})}apiError(e,t,s){var a;this.error("API Error: ".concat(e),{component:"API",action:"request",metadata:{endpoint:e,error:(null==t?void 0:t.message)||t,status:null==t?void 0:null===(a=t.response)||void 0===a?void 0:a.status,...s}})}navigation(e,t){this.info("Navigation: ".concat(e," -> ").concat(t),{component:"Router",action:"navigation",metadata:{from:e,to:t}})}componentError(e,t,s){this.error("Component Error: ".concat(e),{component:e,action:"render",metadata:{error:(null==t?void 0:t.message)||t,stack:null==t?void 0:t.stack,...s}})}constructor(){this.isEnabled=!0,this.isEnabled=!1}}let o=new n,i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,n]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=localStorage.getItem("token");if(!e){d(!1);return}l.h.defaults.headers.common.Authorization="Bearer ".concat(e);let t=await l.h.get("/auth/profile");n(t.data)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("token"),delete l.h.defaults.headers.common.Authorization}finally{d(!1)}},m=async(e,t)=>{try{o.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:s,token:a,requiresTwoFactor:r,userId:i,requiresPasswordChange:c}=(await l.h.post("/auth/login",{email:e,password:t})).data;if(r)return{requiresTwoFactor:!0,userId:i};if(c)return{requiresPasswordChange:!0,userId:i};return localStorage.setItem("token",a),l.h.defaults.headers.common.Authorization="Bearer ".concat(a),n(s),o.info("Login successful",{component:"Auth",action:"login",metadata:{userId:s.id,email:e}}),{}}catch(n){var s,a,r;let t=null==n?void 0:null===(s=n.response)||void 0===s?void 0:s.status,l=null==n?void 0:null===(r=n.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error;throw o.apiError("/auth/login",n,{email:e}),Error(401===t?"Неверный email или пароль":500===t?"Ошибка сервера при входе":l||"Ошибка входа")}},h=async e=>{try{let{userId:t,email:s}=(await l.h.post("/auth/register",e)).data;return{userId:t,email:s}}catch(l){var t,s,a;let e=null==l?void 0:null===(t=l.response)||void 0===t?void 0:t.status,r=null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error;throw Error(409===e?"Пользователь с таким email уже существует":r||"Ошибка регистрации")}},x=async e=>{try{let t=await l.h.put("/auth/profile",e);n(e=>e?{...e,...t.data}:null)}catch(e){var t,s;throw Error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Ошибка обновления профиля")}},p=async(e,t)=>{try{let{token:s,user:a}=(await l.h.post("/auth/verify-2fa",{userId:e,code:t})).data;return localStorage.setItem("token",s),l.h.defaults.headers.common.Authorization="Bearer ".concat(s),n(a),s}catch(e){var s,a;throw Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Ошибка подтверждения 2FA")}},f=async(e,t)=>{try{let{token:s,user:a}=(await l.h.post("/auth/verify-email",{userId:e,code:t})).data;return s&&(localStorage.setItem("token",s),l.h.defaults.headers.common.Authorization="Bearer ".concat(s),n(a)),s}catch(e){var s,a;throw Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Ошибка подтверждения email")}},g=async(e,t)=>{try{await l.h.post("/auth/resend-code",{userId:e,type:t})}catch(e){var s,a;throw Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Ошибка отправки кода")}},v=async e=>{try{return(await l.h.post("/auth/check-company",{inn:e})).data}catch(e){var t,s;throw Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Ошибка проверки компании")}},j=async(e,t,s)=>{try{await l.h.put("/auth/force-change-password",{userId:e,currentPassword:t,newPassword:s})}catch(e){var a,r;throw Error((null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error)||"Ошибка смены пароля")}};return(0,a.jsx)(i.Provider,{value:{user:s,loading:c,login:m,register:h,logout:()=>{o.info("User logout",{component:"Auth",action:"logout",metadata:{userId:null==s?void 0:s.id}}),localStorage.removeItem("token"),delete l.h.defaults.headers.common.Authorization,n(null),window.location.href="/login"},updateProfile:x,verifyTwoFactor:p,verifyEmail:f,resendCode:g,checkCompany:v,forceChangePassword:j},children:t})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[737,251,279,971,938,744],function(){return e(e.s=2231)}),_N_E=e.O()}]);