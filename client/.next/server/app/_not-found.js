(()=>{var e={};e.id=165,e.ids=[165],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},2766:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>l,routeModule:()=>p,tree:()=>c});var o=r(482),s=r(9108),a=r(2563),n=r.n(a),i=r(8300),u={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(u[e]=()=>i[e]);r.d(t,u);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],l=[],d="/_not-found",h={require:r,loadChunk:()=>Promise.resolve()},p=new o.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/_not-found",pathname:"/_not-found",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2676:(e,t,r)=>{Promise.resolve().then(r.bind(r,843)),Promise.resolve().then(r.bind(r,4669))},5517:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},8117:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});let o=r(1934).Z.create({baseURL:"https://vgk-perv.ru/api",headers:{"Content-Type":"application/json"}});o.interceptors.response.use(e=>e,e=>((e.response?.status===401||e.response?.status===403)&&(localStorage.removeItem("token"),delete o.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e))),o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e))},843:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthProvider:()=>c,useAuth:()=>l});var o=r(5344),s=r(3729),a=r(8117);class n{constructor(){this.isEnabled=!0,this.isEnabled=!1}async sendLog(e,t,r={}){if(this.isEnabled)try{await a.h.post("/admin/logs/client",{level:e,message:t,component:r.component,action:r.action,url:r.url||window.location.href,metadata:r.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,t){console.error(`[CLIENT ERROR] ${e}`,t),this.sendLog("error",e,t)}warn(e,t){console.warn(`[CLIENT WARN] ${e}`,t),this.sendLog("warn",e,t)}info(e,t){console.info(`[CLIENT INFO] ${e}`,t),this.sendLog("info",e,t)}debug(e,t){console.debug(`[CLIENT DEBUG] ${e}`,t),this.sendLog("debug",e,t)}userAction(e,t,r){this.info(`User action: ${e}`,{component:t,action:e,metadata:r})}apiError(e,t,r){this.error(`API Error: ${e}`,{component:"API",action:"request",metadata:{endpoint:e,error:t?.message||t,status:t?.response?.status,...r}})}navigation(e,t){this.info(`Navigation: ${e} -> ${t}`,{component:"Router",action:"navigation",metadata:{from:e,to:t}})}componentError(e,t,r){this.error(`Component Error: ${e}`,{component:e,action:"render",metadata:{error:t?.message||t,stack:t?.stack,...r}})}}let i=new n,u=(0,s.createContext)(void 0);function c({children:e}){let[t,r]=(0,s.useState)(null),[n,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{l()},[]);let l=async()=>{try{let e=localStorage.getItem("token");if(!e){c(!1);return}a.h.defaults.headers.common.Authorization=`Bearer ${e}`;let t=await a.h.get("/auth/profile");r(t.data)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("token"),delete a.h.defaults.headers.common.Authorization}finally{c(!1)}},d=async(e,t)=>{try{i.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:o,token:s,requiresTwoFactor:n,userId:u,requiresPasswordChange:c}=(await a.h.post("/auth/login",{email:e,password:t})).data;if(n)return{requiresTwoFactor:!0,userId:u};if(c)return{requiresPasswordChange:!0,userId:u};return localStorage.setItem("token",s),a.h.defaults.headers.common.Authorization=`Bearer ${s}`,r(o),i.info("Login successful",{component:"Auth",action:"login",metadata:{userId:o.id,email:e}}),{}}catch(o){let t=o?.response?.status,r=o?.response?.data?.error;throw i.apiError("/auth/login",o,{email:e}),Error(401===t?"Неверный email или пароль":500===t?"Ошибка сервера при входе":r||"Ошибка входа")}},h=async e=>{try{let{userId:t,email:r}=(await a.h.post("/auth/register",e)).data;return{userId:t,email:r}}catch(r){let e=r?.response?.status,t=r?.response?.data?.error;throw Error(409===e?"Пользователь с таким email уже существует":t||"Ошибка регистрации")}},p=async e=>{try{let t=await a.h.put("/auth/profile",e);r(e=>e?{...e,...t.data}:null)}catch(e){throw Error(e.response?.data?.error||"Ошибка обновления профиля")}},m=async(e,t)=>{try{let{token:o,user:s}=(await a.h.post("/auth/verify-2fa",{userId:e,code:t})).data;return localStorage.setItem("token",o),a.h.defaults.headers.common.Authorization=`Bearer ${o}`,r(s),o}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения 2FA")}},g=async(e,t)=>{try{let{token:o,user:s}=(await a.h.post("/auth/verify-email",{userId:e,code:t})).data;return o&&(localStorage.setItem("token",o),a.h.defaults.headers.common.Authorization=`Bearer ${o}`,r(s)),o}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения email")}},x=async(e,t)=>{try{await a.h.post("/auth/resend-code",{userId:e,type:t})}catch(e){throw Error(e?.response?.data?.error||"Ошибка отправки кода")}},f=async e=>{try{return(await a.h.post("/auth/check-company",{inn:e})).data}catch(e){throw Error(e?.response?.data?.error||"Ошибка проверки компании")}},y=async(e,t,r)=>{try{await a.h.put("/auth/force-change-password",{userId:e,currentPassword:t,newPassword:r})}catch(e){throw Error(e?.response?.data?.error||"Ошибка смены пароля")}};return o.jsx(u.Provider,{value:{user:t,loading:n,login:d,register:h,logout:()=>{i.info("User logout",{component:"Auth",action:"logout",metadata:{userId:t?.id}}),localStorage.removeItem("token"),delete a.h.defaults.headers.common.Authorization,r(null),window.location.href="/login"},updateProfile:p,verifyTwoFactor:m,verifyEmail:g,resendCode:x,checkCompany:f,forceChangePassword:y},children:e})}function l(){let e=(0,s.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8762:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p,metadata:()=>h});var o=r(5036),s=r(8592),a=r.n(s);r(7272);var n=r(6843);let i=(0,n.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx`),{__esModule:u,$$typeof:c}=i;i.default;let l=(0,n.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#AuthProvider`);(0,n.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#useAuth`);var d=r(9636);let h={title:"Система автоматизации дропшиппинга",description:"Веб-система с личными кабинетами для клиентов и операторов"};function p({children:e}){return o.jsx("html",{lang:"ru",children:o.jsx("body",{className:a().className,children:(0,o.jsxs)(l,{children:[e,o.jsx(d.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})})})}},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[456,472],()=>r(2766));module.exports=o})();