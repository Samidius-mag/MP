(()=>{var e={};e.id=11,e.ids=[11],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5481:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=s(482),a=s(9108),n=s(2563),i=s.n(n),o=s(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["register",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1996)),"/home/samidius/MP/client/app/register/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/samidius/MP/client/app/register/page.tsx"],u="/register/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/register/page",pathname:"/register",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8322:(e,t,s)=>{Promise.resolve().then(s.bind(s,843)),Promise.resolve().then(s.bind(s,4669))},1815:(e,t,s)=>{Promise.resolve().then(s.bind(s,7174))},5517:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,6840,23)),Promise.resolve().then(s.t.bind(s,8771,23)),Promise.resolve().then(s.t.bind(s,3225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,3982,23))},7174:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(5344),a=s(843),n=s(2254),i=s(3729),o=s.n(i),l=s(708),c=s(4669),d=s(783),u=s.n(d);function m({content:e}){return(0,r.jsxs)("div",{className:"group relative inline-block",children:[r.jsx("span",{className:"text-gray-400 hover:text-gray-600 cursor-help",children:"?"}),(0,r.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10",children:[e,r.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]})}function h(){let[e,t]=(0,i.useState)(!1),[s,n]=(0,i.useState)(!1),[d,h]=(0,i.useState)(null),{register:p,checkCompany:x}=(0,a.useAuth)(),{register:g,handleSubmit:f,watch:j,formState:{errors:b},setValue:y}=(0,l.cI)(),v=j("password"),w=j("inn"),N=async e=>{if(e&&!(e.length<10)){n(!0);try{let t=await x(e);h(t.data),c.default.success("Компания найдена и проверена")}catch(t){h({inn:e,name:`Компания с ИНН ${e}`,form:10===e.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:t.message||"Ошибка проверки через ФНС"}}),(0,c.default)("Ошибка проверки ФНС, но регистрация возможна",{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e",border:"1px solid #f59e0b"}})}finally{n(!1)}}};o().useEffect(()=>{let e=setTimeout(()=>{w&&w.length>=10&&N(w)},1e3);return()=>clearTimeout(e)},[w]);let P=async e=>{if(e.password!==e.confirmPassword){c.default.error("Пароли не совпадают");return}d||h({inn:e.inn,name:`Компания с ИНН ${e.inn}`,form:10===e.inn.length?"IP":"OOO",ogrn:"",status:"Не проверено в ФНС",reliability:{status:"unknown",message:"Компания не проверена через ФНС"}}),t(!0);try{await p({...e,companyData:d,termsAccepted:e.termsAccepted}),c.default.success("Регистрация выполнена успешно"),window.location.href="/client/dashboard"}catch(e){c.default.error(e.message||"Ошибка регистрации")}finally{t(!1)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("form",{className:"space-y-6",onSubmit:f(P),children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"firstName",className:"label flex items-center gap-2",children:["Имя *",r.jsx(m,{content:"Введите ваше имя"})]}),r.jsx("input",{...g("firstName",{required:"Имя обязательно"}),type:"text",className:`input ${b.firstName?"input-error":""}`,placeholder:"Введите ваше имя",autoComplete:"off"}),b.firstName&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.firstName.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"lastName",className:"label flex items-center gap-2",children:["Фамилия *",r.jsx(m,{content:"Введите вашу фамилию"})]}),r.jsx("input",{...g("lastName",{required:"Фамилия обязательна"}),type:"text",className:`input ${b.lastName?"input-error":""}`,placeholder:"Введите вашу фамилию",autoComplete:"off"}),b.lastName&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.lastName.message})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"email",className:"label flex items-center gap-2",children:["Email *",r.jsx(m,{content:"Ваш email для входа"})]}),r.jsx("input",{...g("email",{required:"Email обязателен",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Неверный формат email"}}),type:"email",className:`input ${b.email?"input-error":""}`,placeholder:"Введите ваш email",autoComplete:"off"}),b.email&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"phone",className:"label flex items-center gap-2",children:["Телефон *",r.jsx(m,{content:"Ваш контактный номер телефона"})]}),r.jsx("input",{...g("phone",{required:"Телефон обязателен",pattern:{value:/^[\+]?[1-9][\d]{0,15}$/,message:"Неверный формат телефона"}}),type:"tel",className:`input ${b.phone?"input-error":""}`,placeholder:"+7 (999) 123-45-67",autoComplete:"off"}),b.phone&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.phone.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"inn",className:"label flex items-center gap-2",children:["ИНН компании *",r.jsx(m,{content:"Введите ИНН вашей компании. Данные будут автоматически получены из базы ФНС"})]}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{...g("inn",{required:"ИНН обязателен",pattern:{value:/^\d{10,12}$/,message:"ИНН должен содержать 10-12 цифр"}}),type:"text",className:`input pr-10 ${b.inn?"input-error":""}`,placeholder:"1234567890",autoComplete:"off"}),s&&r.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),b.inn&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.inn.message})]}),d&&(0,r.jsxs)("div",{className:`p-4 rounded-lg border ${d.status&&!d.status.includes("Не проверено")?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:d.status&&!d.status.includes("Не проверено")?"text-green-600":"text-yellow-600",children:d.status&&!d.status.includes("Не проверено")?"✓":"⚠"}),r.jsx("h3",{className:`font-medium ${d.status&&!d.status.includes("Не проверено")?"text-green-800":"text-yellow-800"}`,children:d.status&&!d.status.includes("Не проверено")?"Компания найдена и проверена":"Компания не проверена в ФНС"})]}),(0,r.jsxs)("div",{className:`text-sm space-y-1 ${d.status&&!d.status.includes("Не проверено")?"text-green-700":"text-yellow-700"}`,children:[(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Название:"})," ",d.name]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Форма:"})," ","OOO"===d.form?"ООО":"ИП"]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"ИНН:"})," ",d.inn]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"ОГРН:"})," ",d.ogrn||"Не указан"]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Статус:"})," ",d.status]}),d.reliability&&(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Надежность:"})," ",d.reliability.message]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"password",className:"label flex items-center gap-2",children:["Пароль *",r.jsx(m,{content:"Минимум 8 символов, 1 заглавная буква, 1 спецсимвол. Пример: HgyE#8"})]}),r.jsx("input",{...g("password",{required:"Пароль обязателен",minLength:{value:8,message:"Пароль должен содержать минимум 8 символов"},pattern:{value:/^(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/,message:"Пароль должен содержать минимум 8 символов, 1 заглавную букву и 1 спецсимвол"}}),type:"password",className:`input ${b.password?"input-error":""}`,placeholder:"Введите пароль",autoComplete:"new-password"}),b.password&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.password.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"confirmPassword",className:"label flex items-center gap-2",children:["Подтверждение пароля *",r.jsx(m,{content:"Повторите пароль для подтверждения"})]}),r.jsx("input",{...g("confirmPassword",{required:"Подтверждение пароля обязательно",validate:e=>e===v||"Пароли не совпадают"}),type:"password",className:`input ${b.confirmPassword?"input-error":""}`,placeholder:"Подтвердите пароль",autoComplete:"new-password"}),b.confirmPassword&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.confirmPassword.message})]}),(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex items-center h-5",children:r.jsx("input",{...g("termsAccepted",{required:"Необходимо согласие с офертой"}),type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),(0,r.jsxs)("div",{className:"ml-3 text-sm",children:[(0,r.jsxs)("label",{htmlFor:"termsAccepted",className:"font-medium text-gray-700",children:["Я согласен с"," ",r.jsx("a",{href:"/terms",className:"text-blue-600 hover:text-blue-500 underline",children:"условиями оферты"})," ","и"," ",r.jsx("a",{href:"/privacy",className:"text-blue-600 hover:text-blue-500 underline",children:"политикой конфиденциальности"}),"*"]}),b.termsAccepted&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.termsAccepted.message})]})]}),r.jsx("div",{children:r.jsx("button",{type:"submit",disabled:e,className:"btn-primary w-full",children:e?"Регистрация...":"Зарегистрироваться"})})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300"})}),r.jsx("div",{className:"relative flex justify-center text-sm",children:r.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Или"})})]}),r.jsx("div",{className:"mt-6",children:r.jsx(u(),{href:"/login",className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Уже есть аккаунт? Войти"})})]})]})}function p(){let{user:e,loading:t}=(0,a.useAuth)(),s=(0,n.useRouter)();return((0,i.useEffect)(()=>{if(!t&&e)switch(e.role){case"client":s.push("/client/dashboard");break;case"operator":s.push("/operator/dashboard");break;case"admin":s.push("/admin")}},[e,t,s]),t||e)?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[r.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Регистрация"}),r.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Создайте новый аккаунт"})]})}),r.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:r.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:r.jsx(h,{})})})]})}},8117:(e,t,s)=>{"use strict";s.d(t,{h:()=>n});var r=s(1934);let a=process.env.NEXT_PUBLIC_API_URL||"https://vgk-perv.ru/api",n=r.Z.create({baseURL:a,headers:{"Content-Type":"application/json"},timeout:6e4});n.interceptors.response.use(e=>e,e=>((e.response?.status===401||e.response?.status===403)&&(localStorage.removeItem("token"),delete n.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e))),n.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e))},843:(e,t,s)=>{"use strict";s.r(t),s.d(t,{AuthProvider:()=>c,useAuth:()=>d});var r=s(5344),a=s(3729),n=s(8117);class i{constructor(){this.isEnabled=!0,this.isEnabled=!1}async sendLog(e,t,s={}){if(this.isEnabled)try{await n.h.post("/admin/logs/client",{level:e,message:t,component:s.component,action:s.action,url:s.url||window.location.href,metadata:s.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,t){console.error(`[CLIENT ERROR] ${e}`,t),this.sendLog("error",e,t)}warn(e,t){console.warn(`[CLIENT WARN] ${e}`,t),this.sendLog("warn",e,t)}info(e,t){console.info(`[CLIENT INFO] ${e}`,t),this.sendLog("info",e,t)}debug(e,t){console.debug(`[CLIENT DEBUG] ${e}`,t),this.sendLog("debug",e,t)}userAction(e,t,s){this.info(`User action: ${e}`,{component:t,action:e,metadata:s})}apiError(e,t,s){this.error(`API Error: ${e}`,{component:"API",action:"request",metadata:{endpoint:e,error:t?.message||t,status:t?.response?.status,...s}})}navigation(e,t){this.info(`Navigation: ${e} -> ${t}`,{component:"Router",action:"navigation",metadata:{from:e,to:t}})}componentError(e,t,s){this.error(`Component Error: ${e}`,{component:e,action:"render",metadata:{error:t?.message||t,stack:t?.stack,...s}})}}let o=new i,l=(0,a.createContext)(void 0);function c({children:e}){let[t,s]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{d()},[]);let d=async()=>{let e=localStorage.getItem("token");if(!e){c(!1);return}n.h.defaults.headers.common.Authorization=`Bearer ${e}`;let t=0;for(;t<5;)try{let e=await n.h.get("/auth/profile");s(e.data),c(!1);return}catch(r){let e=r?.response?.status;if(t++,401===e||403===e){localStorage.removeItem("token"),delete n.h.defaults.headers.common.Authorization,s(null),c(!1);return}await new Promise(e=>setTimeout(e,Math.min(5e3,500*t)))}c(!1)},u=async(e,t)=>{try{o.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:r,token:a,requiresTwoFactor:i,userId:l,requiresPasswordChange:c}=(await n.h.post("/auth/login",{email:e,password:t})).data;if(i)return{requiresTwoFactor:!0,userId:l};if(c)return{requiresPasswordChange:!0,userId:l};return localStorage.setItem("token",a),n.h.defaults.headers.common.Authorization=`Bearer ${a}`,s(r),o.info("Login successful",{component:"Auth",action:"login",metadata:{userId:r.id,email:e}}),{}}catch(r){let t=r?.response?.status,s=r?.response?.data?.error;throw o.apiError("/auth/login",r,{email:e}),Error(401===t?"Неверный email или пароль":500===t?"Ошибка сервера при входе":s||"Ошибка входа")}},m=async e=>{try{let{token:t,user:r}=(await n.h.post("/auth/register",e)).data;if(t&&r)return localStorage.setItem("token",t),n.h.defaults.headers.common.Authorization=`Bearer ${t}`,s(r),{token:t};return{}}catch(s){let e=s?.response?.status,t=s?.response?.data?.error;throw Error(409===e?"Пользователь с таким email уже существует":t||"Ошибка регистрации")}},h=async e=>{try{let t=await n.h.put("/auth/profile",e);s(e=>e?{...e,...t.data}:null)}catch(e){throw Error(e.response?.data?.error||"Ошибка обновления профиля")}},p=async(e,t)=>{try{let{token:r,user:a}=(await n.h.post("/auth/verify-2fa",{userId:e,code:t})).data;return localStorage.setItem("token",r),n.h.defaults.headers.common.Authorization=`Bearer ${r}`,s(a),r}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения 2FA")}},x=async(e,t)=>{try{let{token:r,user:a}=(await n.h.post("/auth/verify-email",{userId:e,code:t})).data;return r&&(localStorage.setItem("token",r),n.h.defaults.headers.common.Authorization=`Bearer ${r}`,s(a)),r}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения email")}},g=async(e,t)=>{try{await n.h.post("/auth/resend-code",{userId:e,type:t})}catch(e){throw Error(e?.response?.data?.error||"Ошибка отправки кода")}},f=async e=>{try{return(await n.h.post("/auth/check-company",{inn:e})).data}catch(e){throw Error(e?.response?.data?.error||"Ошибка проверки компании")}},j=async(e,t,s)=>{try{await n.h.put("/auth/force-change-password",{userId:e,currentPassword:t,newPassword:s})}catch(e){throw Error(e?.response?.data?.error||"Ошибка смены пароля")}};return r.jsx(l.Provider,{value:{user:t,loading:i,login:u,register:m,logout:()=>{o.info("User logout",{component:"Auth",action:"logout",metadata:{userId:t?.id}}),localStorage.removeItem("token"),delete n.h.defaults.headers.common.Authorization,s(null),window.location.href="/login"},updateProfile:h,verifyTwoFactor:p,verifyEmail:x,resendCode:g,checkCompany:f,forceChangePassword:j},children:e})}function d(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8762:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h,metadata:()=>m});var r=s(5036),a=s(8592),n=s.n(a);s(7272);var i=s(6843);let o=(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx`),{__esModule:l,$$typeof:c}=o;o.default;let d=(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#AuthProvider`);(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#useAuth`);var u=s(9636);let m={title:"Система автоматизации дропшиппинга",description:"Веб-система с личными кабинетами для клиентов и операторов"};function h({children:e}){return r.jsx("html",{lang:"ru",children:r.jsx("body",{className:n().className,children:(0,r.jsxs)(d,{children:[e,r.jsx(u.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})})})}},1996:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(6843).createProxy)(String.raw`/home/samidius/MP/client/app/register/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default},4697:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(337);let a=e=>[{type:"image/svg+xml",sizes:"any",url:(0,r.fillMetadataSegment)(".",e.params,"icon.svg")+"?5a14f14a44901342"}]},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[456,472,898,783,708],()=>s(5481));module.exports=r})();