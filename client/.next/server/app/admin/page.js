(()=>{var e={};e.id=3,e.ids=[3],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},3955:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>c});var a=t(482),r=t(9108),l=t(2563),i=t.n(l),d=t(8300),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(s,n);let c=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9481)),"/home/samidius/MP/client/app/admin/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/home/samidius/MP/client/app/admin/page.tsx"],m="/admin/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8831:(e,s,t)=>{Promise.resolve().then(t.bind(t,1638))},8322:(e,s,t)=>{Promise.resolve().then(t.bind(t,843)),Promise.resolve().then(t.bind(t,4669))},5517:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2583,23)),Promise.resolve().then(t.t.bind(t,6840,23)),Promise.resolve().then(t.t.bind(t,8771,23)),Promise.resolve().then(t.t.bind(t,3225,23)),Promise.resolve().then(t.t.bind(t,9295,23)),Promise.resolve().then(t.t.bind(t,3982,23))},1638:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var a=t(5344),r=t(3729),l=t(843),i=t(2254),d=t(8117);function n(){let[e,s]=(0,r.useState)(null),[t,l]=(0,r.useState)(null),[i,n]=(0,r.useState)(!0),[c,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{m()},[]);let m=async()=>{try{n(!0);let[e,t]=await Promise.all([d.h.get("/admin/stats"),d.h.get("/admin/logs/stats")]);s(e.data),l(t.data)}catch(e){o(e.response?.data?.error||"Ошибка загрузки данных")}finally{n(!1)}};return i?a.jsx("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>a.jsx("div",{className:"h-24 bg-gray-200 rounded"},s))})]})}):c?a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:a.jsx("div",{className:"flex",children:(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Ошибка загрузки"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:c})]})})})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Обзор системы"}),a.jsx("p",{className:"text-gray-600",children:"Статистика и ключевые показатели"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:a.jsx("span",{className:"text-white text-sm font-medium",children:"\uD83D\uDC65"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Всего пользователей"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:e?.overview.totalUsers||0})]})]})}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:a.jsx("span",{className:"text-white text-sm font-medium",children:"\uD83C\uDFE2"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Клиентов"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:e?.overview.totalClients||0})]})]})}),a.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center",children:a.jsx("span",{className:"text-white text-sm font-medium",children:"\uD83D\uDCE6"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Заказов"}),a.jsx("p",{className:"text-2xl font-bold text-purple-900",children:e?.overview.totalOrders||0})]})]})}),a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:a.jsx("span",{className:"text-white text-sm font-medium",children:"\uD83D\uDCB0"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Комиссия (1.5%)"}),a.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:e?.overview.totalRevenue?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e.overview.totalRevenue):"₽0"})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Пользователи по ролям"}),a.jsx("div",{className:"space-y-3",children:e?.usersByRole&&Object.entries(e.usersByRole).map(([e,s])=>(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:"client"===e?"Клиенты":"operator"===e?"Операторы":"Администраторы"}),a.jsx("span",{className:"text-sm font-bold text-gray-900",children:s})]},e))})]}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Заказы по статусам"}),a.jsx("div",{className:"space-y-3",children:e?.ordersByStatus&&Object.entries(e.ordersByStatus).map(([e,s])=>(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600 capitalize",children:"new"===e?"Новые":"in_assembly"===e?"В сборке":"ready_to_ship"===e?"Готов к отправке":"shipped"===e?"Отправлен":"delivered"===e?"Доставлен":"cancelled"===e?"Отменен":e}),a.jsx("span",{className:"text-sm font-bold text-gray-900",children:s})]},e))})]})]}),t&&(0,a.jsxs)("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Статистика логов (24 часа)"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Логи сервера"}),a.jsx("div",{className:"space-y-2",children:t.serverLogs.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded ${"error"===e.level?"bg-red-100 text-red-800":"warn"===e.level?"bg-yellow-100 text-yellow-800":"info"===e.level?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:e.level.toUpperCase()}),a.jsx("span",{className:"text-sm font-bold text-gray-900",children:e.count})]},e.level))})]}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Логи клиента"}),a.jsx("div",{className:"space-y-2",children:t.clientLogs.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded ${"error"===e.level?"bg-red-100 text-red-800":"warn"===e.level?"bg-yellow-100 text-yellow-800":"info"===e.level?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:e.level.toUpperCase()}),a.jsx("span",{className:"text-sm font-bold text-gray-900",children:e.count})]},e.level))})]})]})]})]})}var c=t(4669);function o(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(null),[i,n]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0),[x,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)(""),[y,f]=(0,r.useState)(""),[j,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[k,C]=(0,r.useState)(1),[S,P]=(0,r.useState)(1),[_,E]=(0,r.useState)(!1),[D,$]=(0,r.useState)(!1),[A,I]=(0,r.useState)({firstName:"",lastName:""}),[q,L]=(0,r.useState)(null),[R,z]=(0,r.useState)(!1),[U,B]=(0,r.useState)(!1),[O,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{F()},[k,j,N]);let F=async()=>{try{m(!0);let e=new URLSearchParams({page:k.toString(),limit:"20"});j&&e.append("search",j),N&&e.append("role",N);let t=await d.h.get(`/admin/users?${e}`);s(t.data.users),P(t.data.pagination.totalPages)}catch(e){c.default.error(e.response?.data?.error||"Ошибка загрузки пользователей")}finally{m(!1)}},T=async e=>{try{let s=await d.h.get(`/admin/users/${e}`);l(s.data.user),n(s.data.stats)}catch(e){c.default.error(e.response?.data?.error||"Ошибка загрузки данных пользователя")}},G=async(e,s)=>{try{u(!0),await d.h.put(`/admin/users/${e}/status`,{isActive:s}),c.default.success(`Пользователь ${s?"активирован":"заблокирован"}`),F(),t?.id===e&&l(e=>e?{...e,is_active:s}:null)}catch(e){c.default.error(e.response?.data?.error||"Ошибка изменения статуса")}finally{u(!1)}},J=async()=>{if(!A.firstName||!A.lastName){c.default.error("Заполните все обязательные поля");return}$(!0);try{let e=await d.h.post("/admin/users/operator",A);L(e.data.credentials),c.default.success("Оператор успешно создан"),I({firstName:"",lastName:""}),await F()}catch(e){c.default.error(e.response?.data?.error||"Ошибка создания оператора")}finally{$(!1)}},W=e=>{M(e),z(!0)},X=async()=>{if(O){B(!0);try{await d.h.delete(`/admin/users/${O.id}`),c.default.success(`Пользователь ${O.first_name} ${O.last_name} успешно удален`),z(!1),M(null),t?.id===O.id&&(l(null),n(null)),await F()}catch(e){c.default.error(e.response?.data?.error||"Ошибка удаления пользователя")}finally{B(!1)}}},H=async()=>{if(p!==y){c.default.error("Пароли не совпадают");return}if(p.length<8){c.default.error("Пароль должен содержать минимум 8 символов");return}try{u(!0),await d.h.put(`/admin/users/${t?.id}/password`,{newPassword:p,confirmPassword:y}),c.default.success("Пароль успешно изменен"),g(!1),b(""),f("")}catch(e){c.default.error(e.response?.data?.error||"Ошибка смены пароля")}finally{u(!1)}},Z=e=>{switch(e){case"client":return"Клиент";case"operator":return"Оператор";case"admin":return"Администратор";default:return e}},K=e=>a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e?"Активен":"Заблокирован"});return o?a.jsx("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>a.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})]})}):(0,a.jsxs)("div",{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Управление пользователями"}),a.jsx("p",{className:"text-gray-600",children:"Просмотр и управление пользователями системы"})]}),a.jsx("button",{onClick:()=>E(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"+ Создать оператора"})]})}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{type:"text",placeholder:"Поиск по email, имени или компании...",value:j,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Все роли"}),a.jsx("option",{value:"client",children:"Клиенты"}),a.jsx("option",{value:"operator",children:"Операторы"}),a.jsx("option",{value:"admin",children:"Администраторы"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Список пользователей"})}),a.jsx("div",{className:"divide-y divide-gray-200",children:e.map(e=>a.jsx("div",{className:`p-4 hover:bg-gray-50 cursor-pointer ${t?.id===e.id?"bg-blue-50":""}`,onClick:()=>T(e.id),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"flex items-center space-x-3",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]}),a.jsx("p",{className:"text-sm text-gray-500",children:e.email}),e.company_name&&a.jsx("p",{className:"text-xs text-gray-400",children:e.company_name})]})})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-xs text-gray-500",children:Z(e.role)}),K(e.is_active)]})]})},e.id))}),S>1&&(0,a.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[a.jsx("button",{onClick:()=>C(k-1),disabled:1===k,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Страница ",k," из ",S]}),a.jsx("button",{onClick:()=>C(k+1),disabled:k===S,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]})}),a.jsx("div",{className:"lg:col-span-1",children:t?(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Детали пользователя"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Имя"}),(0,a.jsxs)("p",{className:"text-sm text-gray-900",children:[t.first_name," ",t.last_name]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),a.jsx("p",{className:"text-sm text-gray-900",children:t.email})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Телефон"}),a.jsx("p",{className:"text-sm text-gray-900",children:t.phone})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Роль"}),a.jsx("p",{className:"text-sm text-gray-900",children:Z(t.role)})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Статус"}),a.jsx("div",{className:"mt-1",children:K(t.is_active)})]}),t.company_name&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Компания"}),a.jsx("p",{className:"text-sm text-gray-900",children:t.company_name})]}),t.inn&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"ИНН"}),a.jsx("p",{className:"text-sm text-gray-900",children:t.inn})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Дата регистрации"}),a.jsx("p",{className:"text-sm text-gray-900",children:new Date(t.created_at).toLocaleDateString("ru-RU")})]}),"client"===t.role&&i&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Статистика"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Заказов:"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:i.totalOrders})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Сумма заказов:"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(i.totalAmount)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Баланс:"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(i.currentBalance)})]})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200 space-y-2",children:[a.jsx("button",{onClick:()=>G(t.id,!t.is_active),disabled:x,className:`w-full px-3 py-2 text-sm font-medium rounded-md ${t.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"} disabled:opacity-50`,children:t.is_active?"Заблокировать":"Активировать"}),a.jsx("button",{onClick:()=>g(!0),className:"w-full px-3 py-2 text-sm font-medium text-blue-700 bg-blue-100 rounded-md hover:bg-blue-200",children:"Сменить пароль"}),"admin"!==t.role&&a.jsx("button",{onClick:()=>W(t),className:"w-full px-3 py-2 text-sm font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200",children:"Удалить пользователя"})]})]})]}):a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 text-center",children:a.jsx("p",{className:"text-gray-500",children:"Выберите пользователя для просмотра деталей"})})})]}),h&&a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:a.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Смена пароля"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Новый пароль"}),a.jsx("input",{type:"password",value:p,onChange:e=>b(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Минимум 8 символов"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Подтверждение пароля"}),a.jsx("input",{type:"password",value:y,onChange:e=>f(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Повторите пароль"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[a.jsx("button",{onClick:()=>{g(!1),b(""),f("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Отмена"}),a.jsx("button",{onClick:H,disabled:x||!p||!y,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:x?"Сохранение...":"Сохранить"})]})]})})}),_&&a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:a.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Создание оператора"}),q?a.jsx("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:[a.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"Оператор создан успешно!"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Логин:"}),a.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded font-mono text-sm",children:q.login})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Пароль:"}),a.jsx("div",{className:"mt-1 p-2 bg-gray-100 rounded font-mono text-sm",children:q.password})]})]}),a.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Сохраните эти данные! Они больше не будут показаны."})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Имя *"}),a.jsx("input",{type:"text",value:A.firstName,onChange:e=>I(s=>({...s,firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Иван"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Фамилия *"}),a.jsx("input",{type:"text",value:A.lastName,onChange:e=>I(s=>({...s,lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Иванов"})]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:a.jsx("p",{className:"text-sm text-blue-800",children:"Система автоматически сгенерирует логин и пароль для оператора."})})]}),a.jsx("div",{className:"flex justify-end space-x-3 mt-6",children:q?a.jsx("button",{onClick:()=>{E(!1),L(null),I({firstName:"",lastName:""})},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Закрыть"}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>{E(!1),I({firstName:"",lastName:""})},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Отмена"}),a.jsx("button",{onClick:J,disabled:D,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:D?"Создание...":"Создать оператора"})]})})]})})}),R&&O&&a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:a.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:a.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Подтверждение удаления"}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[a.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Вы уверены, что хотите удалить пользователя?"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900",children:[O.first_name," ",O.last_name]}),a.jsx("p",{className:"text-sm text-gray-500",children:O.email}),a.jsx("p",{className:"text-xs text-gray-400",children:Z(O.role)})]}),a.jsx("p",{className:"text-xs text-red-600 mt-2",children:"⚠️ Это действие нельзя отменить"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:()=>{z(!1),M(null)},disabled:U,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50",children:"Отмена"}),a.jsx("button",{onClick:X,disabled:U,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 disabled:opacity-50",children:U?"Удаление...":"Удалить"})]})]})})})]})}function m(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)({page:1,limit:50,total:0,totalPages:0,hasNext:!1,hasPrev:!1}),[i,n]=(0,r.useState)(!0),[c,o]=(0,r.useState)("server"),[m,x]=(0,r.useState)({level:"",service:"",userId:"",component:"",action:"",startDate:"",endDate:""}),[u,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{g()},[c,t.page,m]);let g=async()=>{try{n(!0);let e=new URLSearchParams({page:t.page.toString(),limit:t.limit.toString()});Object.entries(m).forEach(([s,t])=>{t&&e.append(s,t)});let a=(await d.h.get(`/admin/logs/${c}?${e}`)).data;s(a.logs),l(a.pagination)}catch(e){console.error("Error fetching logs:",e)}finally{n(!1)}},p=e=>{let s={error:"bg-red-100 text-red-800",warn:"bg-yellow-100 text-yellow-800",info:"bg-blue-100 text-blue-800",debug:"bg-gray-100 text-gray-800"};return a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s[e]||s.debug}`,children:e.toUpperCase()})},b=e=>new Date(e).toLocaleString("ru-RU"),y=(e,s=100)=>e.length>s?e.substring(0,s)+"...":e,f=(e,s)=>{x(t=>({...t,[e]:s})),l(e=>({...e,page:1}))};return i?a.jsx("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"space-y-3",children:[...Array(10)].map((e,s)=>a.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})]})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Просмотр логов"}),a.jsx("p",{className:"text-gray-600",children:"Мониторинг активности системы и пользователей"})]}),a.jsx("div",{className:"mb-6",children:a.jsx("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[a.jsx("button",{onClick:()=>o("server"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"server"===c?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Логи сервера"}),a.jsx("button",{onClick:()=>o("client"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"client"===c?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Логи клиента"})]})})}),a.jsx("div",{className:"mb-6 bg-gray-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Уровень"}),(0,a.jsxs)("select",{value:m.level,onChange:e=>f("level",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Все уровни"}),a.jsx("option",{value:"error",children:"Error"}),a.jsx("option",{value:"warn",children:"Warning"}),a.jsx("option",{value:"info",children:"Info"}),a.jsx("option",{value:"debug",children:"Debug"})]})]}),"server"===c&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сервис"}),a.jsx("input",{type:"text",value:m.service,onChange:e=>f("service",e.target.value),placeholder:"auth, orders, etc.",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),"client"===c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Компонент"}),a.jsx("input",{type:"text",value:m.component,onChange:e=>f("component",e.target.value),placeholder:"Component name",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Действие"}),a.jsx("input",{type:"text",value:m.action,onChange:e=>f("action",e.target.value),placeholder:"User action",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID пользователя"}),a.jsx("input",{type:"number",value:m.userId,onChange:e=>f("userId",e.target.value),placeholder:"User ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата с"}),a.jsx("input",{type:"datetime-local",value:m.startDate,onChange:e=>f("startDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата по"}),a.jsx("input",{type:"datetime-local",value:m.endDate,onChange:e=>f("endDate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{x({level:"",service:"",userId:"",component:"",action:"",startDate:"",endDate:""}),l(e=>({...e,page:1}))},className:"w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Очистить"})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Логи ","server"===c?"сервера":"клиента","(",t.total," записей)"]})}),a.jsx("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:e.map(e=>a.jsx("div",{className:`p-4 hover:bg-gray-50 cursor-pointer ${u?.id===e.id?"bg-blue-50":""}`,onClick:()=>h(e),children:a.jsx("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[p(e.level),e.service&&a.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:e.service}),a.jsx("span",{className:"text-xs text-gray-400",children:b(e.created_at)})]}),a.jsx("p",{className:"text-sm text-gray-900 mb-1",children:y(e.message)}),e.email&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Пользователь: ",e.email," (",e.first_name," ",e.last_name,")"]})]})})},e.id))}),t.totalPages>1&&(0,a.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[a.jsx("button",{onClick:()=>l(e=>({...e,page:e.page-1})),disabled:!t.hasPrev,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Страница ",t.page," из ",t.totalPages]}),a.jsx("button",{onClick:()=>l(e=>({...e,page:e.page+1})),disabled:!t.hasNext,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]})}),a.jsx("div",{className:"lg:col-span-1",children:u?(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Детали лога"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Уровень"}),a.jsx("div",{className:"mt-1",children:p(u.level)})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Сообщение"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1 break-words",children:u.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Время"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:b(u.created_at)})]}),u.service&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Сервис"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:u.service})]}),u.component&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Компонент"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:u.component})]}),u.action&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Действие"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:u.action})]}),u.email&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Пользователь"}),(0,a.jsxs)("p",{className:"text-sm text-gray-900 mt-1",children:[u.email," (",u.first_name," ",u.last_name,")"]})]}),u.ip_address&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"IP адрес"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1 font-mono",children:u.ip_address})]}),u.request_id&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"ID запроса"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1 font-mono",children:u.request_id})]}),u.metadata&&Object.keys(u.metadata).length>0&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Метаданные"}),a.jsx("pre",{className:"text-xs text-gray-900 mt-1 bg-gray-100 p-2 rounded overflow-x-auto",children:JSON.stringify(u.metadata,null,2)})]})]})]}):a.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 text-center",children:a.jsx("p",{className:"text-gray-500",children:"Выберите лог для просмотра деталей"})})})]})]})}function x(){let[e,s]=(0,r.useState)({}),[t,l]=(0,r.useState)(!0),[i,n]=(0,r.useState)(!1),[o,m]=(0,r.useState)({});(0,r.useEffect)(()=>{x()},[]);let x=async()=>{try{l(!0);let e=await d.h.get("/admin/settings");s(e.data),m(e.data)}catch(e){c.default.error(e.response?.data?.error||"Ошибка загрузки настроек")}finally{l(!1)}},u=(e,s)=>{m(t=>({...t,[e]:{...t[e],value:s}}))},h=async()=>{try{n(!0);let t={};if(Object.entries(o).forEach(([s,a])=>{JSON.stringify(a.value)!==JSON.stringify(e[s]?.value)&&(t[s]={value:a.value})}),0===Object.keys(t).length){c.default.success("Настройки не изменились");return}await d.h.put("/admin/settings",{settings:t}),s(o),c.default.success("Настройки успешно сохранены")}catch(e){c.default.error(e.response?.data?.error||"Ошибка сохранения настроек")}finally{n(!1)}},g=()=>JSON.stringify(o)!==JSON.stringify(e),p=(e,s)=>{let t=s.value,r=typeof t;return"boolean"===r?(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:t,onChange:s=>u(e,s.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t?"Включено":"Отключено"})]}):"number"===r?a.jsx("input",{type:"number",value:t,onChange:s=>u(e,parseFloat(s.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):"object"===r&&null!==t?a.jsx("textarea",{value:JSON.stringify(t,null,2),onChange:s=>{try{let t=JSON.parse(s.target.value);u(e,t)}catch(e){}},rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"}):a.jsx("input",{type:"text",value:t||"",onChange:s=>u(e,s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})};return t?a.jsx("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Настройки системы"}),a.jsx("p",{className:"text-gray-600",children:"Конфигурация параметров системы"})]}),(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:h,disabled:i||!g(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Сохранение...":"Сохранить изменения"}),a.jsx("button",{onClick:()=>{m(e)},disabled:!g(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Сбросить"})]}),g()&&a.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Есть несохраненные изменения"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[Object.entries(o).map(([e,s])=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),s.description&&a.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),a.jsx("div",{className:"max-w-2xl",children:p(e,s)})]},e)),0===Object.keys(o).length&&a.jsx("div",{className:"text-center py-12",children:(0,a.jsxs)("div",{className:"text-gray-500",children:[(0,a.jsxs)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Нет настроек"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Настройки системы не найдены или не загружены."})]})})]})]})}function u(){let{user:e,updateProfile:s}=(0,l.useAuth)(),[t,i]=(0,r.useState)(!1),[d,n]=(0,r.useState)(!1),[o,m]=(0,r.useState)({firstName:"",lastName:"",email:"",phone:""});(0,r.useEffect)(()=>{e&&m({firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||""})},[e]);let x=(e,s)=>{m(t=>({...t,[e]:s}))},u=()=>o.firstName.trim()?o.lastName.trim()?o.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)?!o.phone.trim()||!!/^[\+]?[1-9][\d]{0,15}$/.test(o.phone.trim())||(c.default.error("Неверный формат телефона"),!1):(c.default.error("Неверный формат email"),!1):(c.default.error("Email обязателен для заполнения"),!1):(c.default.error("Фамилия обязательна для заполнения"),!1):(c.default.error("Имя обязательно для заполнения"),!1),h=async()=>{if(u()){n(!0);try{let e={firstName:o.firstName.trim(),lastName:o.lastName.trim(),email:o.email.trim(),...o.phone.trim()&&{phone:o.phone.trim()}};await s(e),c.default.success("Профиль успешно обновлен")}catch(e){c.default.error(e.message||"Ошибка обновления профиля")}finally{n(!1)}}},g=()=>!!e&&(o.firstName.trim()!==(e.firstName||"")||o.lastName.trim()!==(e.lastName||"")||o.email.trim()!==(e.email||"")||o.phone.trim()!==(e.phone||""));return t?a.jsx("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0].map((e,s)=>a.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})]})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Настройки профиля"}),a.jsx("p",{className:"text-gray-600",children:"Управление личными данными администратора"})]}),(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:h,disabled:d||!g(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Сохранение...":"Сохранить изменения"}),a.jsx("button",{onClick:()=>{e&&m({firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||""})},disabled:!g(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Сбросить"})]}),g()&&a.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Есть несохраненные изменения"})]}),(0,a.jsxs)("div",{className:"max-w-2xl space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Личная информация"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя *"}),a.jsx("input",{type:"text",value:o.firstName,onChange:e=>x("firstName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введите имя"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Фамилия *"}),a.jsx("input",{type:"text",value:o.lastName,onChange:e=>x("lastName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введите фамилию"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Контактная информация"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),a.jsx("input",{type:"email",value:o.email,onChange:e=>x("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Введите email"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Email используется для входа в систему"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Телефон"}),a.jsx("input",{type:"tel",value:o.phone,onChange:e=>x("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+7 (999) 123-45-67"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Необязательное поле"})]})]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Важная информация"}),a.jsx("div",{className:"mt-2 text-sm text-blue-700",children:(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-1",children:[a.jsx("li",{children:"Изменение email потребует повторной авторизации"}),a.jsx("li",{children:"Все поля, отмеченные *, обязательны для заполнения"}),a.jsx("li",{children:"Телефон используется для уведомлений и восстановления доступа"})]})})]})]})})]})]})}function h(){let{user:e,loading:s,logout:t}=(0,l.useAuth)(),d=(0,i.useRouter)(),[c,h]=(0,r.useState)("dashboard");return((0,r.useEffect)(()=>{s||e&&"admin"===e.role||d.push("/login")},[e,s,d]),s)?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e&&"admin"===e.role?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Панель администратора"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Управление системой и пользователями"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Добро пожаловать, ",e.firstName," ",e.lastName]}),a.jsx("button",{onClick:()=>d.push("/"),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"На главную"}),a.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Выход"})]})]})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[a.jsx("div",{className:"lg:w-64",children:a.jsx("nav",{className:"space-y-2",children:[{id:"dashboard",name:"Панель управления",icon:"\uD83D\uDCCA"},{id:"users",name:"Пользователи",icon:"\uD83D\uDC65"},{id:"logs",name:"Логи",icon:"\uD83D\uDCCB"},{id:"settings",name:"Настройки системы",icon:"⚙️"},{id:"profile",name:"Мой профиль",icon:"\uD83D\uDC64"}].map(e=>(0,a.jsxs)("button",{onClick:()=>h(e.id),className:`w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors ${c===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[a.jsx("span",{className:"mr-3 text-lg",children:e.icon}),e.name]},e.id))})}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:(()=>{switch(c){case"dashboard":default:return a.jsx(n,{});case"users":return a.jsx(o,{});case"logs":return a.jsx(m,{});case"settings":return a.jsx(x,{});case"profile":return a.jsx(u,{})}})()})})]})})]}):null}},8117:(e,s,t)=>{"use strict";t.d(s,{h:()=>l});var a=t(1934);let r=process.env.NEXT_PUBLIC_API_URL||"https://vgk-perv.ru/api",l=a.Z.create({baseURL:r,headers:{"Content-Type":"application/json"},timeout:6e4});l.interceptors.response.use(e=>e,e=>((e.response?.status===401||e.response?.status===403)&&(localStorage.removeItem("token"),delete l.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e))),l.interceptors.request.use(e=>{let s=localStorage.getItem("token");return s&&(e.headers.Authorization=`Bearer ${s}`),e},e=>Promise.reject(e))},843:(e,s,t)=>{"use strict";t.r(s),t.d(s,{AuthProvider:()=>c,useAuth:()=>o});var a=t(5344),r=t(3729),l=t(8117);class i{constructor(){this.isEnabled=!0,this.isEnabled=!1}async sendLog(e,s,t={}){if(this.isEnabled)try{await l.h.post("/admin/logs/client",{level:e,message:s,component:t.component,action:t.action,url:t.url||window.location.href,metadata:t.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,s){console.error(`[CLIENT ERROR] ${e}`,s),this.sendLog("error",e,s)}warn(e,s){console.warn(`[CLIENT WARN] ${e}`,s),this.sendLog("warn",e,s)}info(e,s){console.info(`[CLIENT INFO] ${e}`,s),this.sendLog("info",e,s)}debug(e,s){console.debug(`[CLIENT DEBUG] ${e}`,s),this.sendLog("debug",e,s)}userAction(e,s,t){this.info(`User action: ${e}`,{component:s,action:e,metadata:t})}apiError(e,s,t){this.error(`API Error: ${e}`,{component:"API",action:"request",metadata:{endpoint:e,error:s?.message||s,status:s?.response?.status,...t}})}navigation(e,s){this.info(`Navigation: ${e} -> ${s}`,{component:"Router",action:"navigation",metadata:{from:e,to:s}})}componentError(e,s,t){this.error(`Component Error: ${e}`,{component:e,action:"render",metadata:{error:s?.message||s,stack:s?.stack,...t}})}}let d=new i,n=(0,r.createContext)(void 0);function c({children:e}){let[s,t]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{o()},[]);let o=async()=>{let e=localStorage.getItem("token");if(!e){c(!1);return}l.h.defaults.headers.common.Authorization=`Bearer ${e}`;let s=0;for(;s<5;)try{let e=await l.h.get("/auth/profile");t(e.data),c(!1);return}catch(a){let e=a?.response?.status;if(s++,401===e||403===e){localStorage.removeItem("token"),delete l.h.defaults.headers.common.Authorization,t(null),c(!1);return}await new Promise(e=>setTimeout(e,Math.min(5e3,500*s)))}c(!1)},m=async(e,s)=>{try{d.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:a,token:r,requiresTwoFactor:i,userId:n,requiresPasswordChange:c}=(await l.h.post("/auth/login",{email:e,password:s})).data;if(i)return{requiresTwoFactor:!0,userId:n};if(c)return{requiresPasswordChange:!0,userId:n};return localStorage.setItem("token",r),l.h.defaults.headers.common.Authorization=`Bearer ${r}`,t(a),d.info("Login successful",{component:"Auth",action:"login",metadata:{userId:a.id,email:e}}),{}}catch(a){let s=a?.response?.status,t=a?.response?.data?.error;throw d.apiError("/auth/login",a,{email:e}),Error(401===s?"Неверный email или пароль":500===s?"Ошибка сервера при входе":t||"Ошибка входа")}},x=async e=>{try{let{token:s,user:a}=(await l.h.post("/auth/register",e)).data;if(s&&a)return localStorage.setItem("token",s),l.h.defaults.headers.common.Authorization=`Bearer ${s}`,t(a),{token:s};return{}}catch(t){let e=t?.response?.status,s=t?.response?.data?.error;throw Error(409===e?"Пользователь с таким email уже существует":s||"Ошибка регистрации")}},u=async e=>{try{let s=await l.h.put("/auth/profile",e);t(e=>e?{...e,...s.data}:null)}catch(e){throw Error(e.response?.data?.error||"Ошибка обновления профиля")}},h=async(e,s)=>{try{let{token:a,user:r}=(await l.h.post("/auth/verify-2fa",{userId:e,code:s})).data;return localStorage.setItem("token",a),l.h.defaults.headers.common.Authorization=`Bearer ${a}`,t(r),a}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения 2FA")}},g=async(e,s)=>{try{let{token:a,user:r}=(await l.h.post("/auth/verify-email",{userId:e,code:s})).data;return a&&(localStorage.setItem("token",a),l.h.defaults.headers.common.Authorization=`Bearer ${a}`,t(r)),a}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения email")}},p=async(e,s)=>{try{await l.h.post("/auth/resend-code",{userId:e,type:s})}catch(e){throw Error(e?.response?.data?.error||"Ошибка отправки кода")}},b=async e=>{try{return(await l.h.post("/auth/check-company",{inn:e})).data}catch(e){throw Error(e?.response?.data?.error||"Ошибка проверки компании")}},y=async(e,s,t)=>{try{await l.h.put("/auth/force-change-password",{userId:e,currentPassword:s,newPassword:t})}catch(e){throw Error(e?.response?.data?.error||"Ошибка смены пароля")}};return a.jsx(n.Provider,{value:{user:s,loading:i,login:m,register:x,logout:()=>{d.info("User logout",{component:"Auth",action:"logout",metadata:{userId:s?.id}}),localStorage.removeItem("token"),delete l.h.defaults.headers.common.Authorization,t(null),window.location.href="/login"},updateProfile:u,verifyTwoFactor:h,verifyEmail:g,resendCode:p,checkCompany:b,forceChangePassword:y},children:e})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9481:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>i});let a=(0,t(6843).createProxy)(String.raw`/home/samidius/MP/client/app/admin/page.tsx`),{__esModule:r,$$typeof:l}=a,i=a.default},8762:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u,metadata:()=>x});var a=t(5036),r=t(8592),l=t.n(r);t(7272);var i=t(6843);let d=(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx`),{__esModule:n,$$typeof:c}=d;d.default;let o=(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#AuthProvider`);(0,i.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#useAuth`);var m=t(9636);let x={title:"Система автоматизации дропшиппинга",description:"Веб-система с личными кабинетами для клиентов и операторов"};function u({children:e}){return a.jsx("html",{lang:"ru",children:a.jsx("body",{className:l().className,children:(0,a.jsxs)(o,{children:[e,a.jsx(m.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})})})}},4697:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(337);let r=e=>[{type:"image/svg+xml",sizes:"any",url:(0,a.fillMetadataSegment)(".",e.params,"icon.svg")+"?5a14f14a44901342"}]},7272:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[456,472,898],()=>t(3955));module.exports=a})();