(()=>{var e={};e.id=893,e.ids=[893],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},1919:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>o});var r=s(482),a=s(9108),i=s(2563),n=s.n(i),l=s(8300),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let o=["",{children:["client",{children:["wb-pricing",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3892)),"/home/samidius/MP/client/app/client/wb-pricing/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/samidius/MP/client/app/client/wb-pricing/page.tsx"],m="/client/wb-pricing/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/client/wb-pricing/page",pathname:"/client/wb-pricing",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},76:(e,t,s)=>{Promise.resolve().then(s.bind(s,8911))},8911:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(5344),a=s(3729),i=s(8779),n=s(8117);function l(){let[e,t]=(0,a.useState)(!1),[s,l]=(0,a.useState)({markupPercent:20,acquiringPercent:2.5,firstLiterLogisticsRub:50,additionalLiterLogisticsRub:10,warehouseCoeffPercent:15,maxDiscountPercent:10,belowRrp:"unknown",localizationIndex:1.2,shipmentHandlingRub:5,minPurchasePriceRub:100,maxPurchasePriceRub:1e4,maintainMarginInPromotions:!0,autoExitPromotions:!0,marketplaceCommissionPercent:0}),[c,o]=(0,a.useState)([]),[d,m]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),h=async()=>{try{console.log("Loading settings...");let e=await n.h.get("/pricing/settings");console.log("Settings loaded:",e.data),l(t=>({...t,...e.data}))}catch(e){console.error("Error loading settings:",e)}},b=async()=>{try{console.log("Saving settings..."),await n.h.put("/pricing/settings",s),console.log("Settings saved successfully!")}catch(e){console.error("Error saving settings:",e)}},f=async()=>{m(!0);try{console.log("Loading products...");let e=await n.h.get("/pricing/products");console.log("Products loaded:",e.data),o(e.data||[])}catch(e){console.error("Error loading products:",e),o([])}finally{m(!1)}},y=async()=>{x(!0);try{console.log("Starting sync using API key from user settings...");let e=await n.h.post("/pricing/sync-products");console.log("Sync response:",e),e&&e.data?(o(e.data.products||[]),console.log(`Синхронизировано ${e.data.count||0} товаров`)):(console.warn("Unexpected response format:",e),o([]))}catch(e){console.error("Error syncing products:",e),o([])}finally{x(!1)}},j=async()=>{try{console.log("Fetching marketplace commission from WB API...");let e=await n.h.post("/pricing/fetch-commission");if(!e||!e.data||!e.data.commission)return l(e=>({...e,marketplaceCommissionPercent:5})),console.log("Using default marketplace commission: 5%"),5;{let t=e.data.commission;return l(e=>({...e,marketplaceCommissionPercent:t})),console.log(`Marketplace commission updated: ${t}%`),t}}catch(e){return console.error("Error fetching marketplace commission:",e),l(e=>({...e,marketplaceCommissionPercent:5})),console.log("Using default marketplace commission: 5%"),5}},v=async e=>{try{console.log("Calculating optimal price for product:",e.nm_id);let t=await n.h.post("/pricing/calculate-price",{productId:e.nm_id,settings:s});if(t&&t.data){if(console.log("Price calculation result:",t.data),t.data.finalPrice&&t.data.finalPrice>0)try{let s=await n.h.put("/pricing/update-price",{productId:e.nm_id,newPrice:t.data.finalPrice});s.data.success&&(console.log("Price updated successfully:",s.data),o(s=>s.map(s=>s.nm_id===e.nm_id?{...s,current_price:t.data.finalPrice}:s)),alert(`Цена товара обновлена на ${t.data.finalPrice} ₽`))}catch(e){console.error("Error updating price:",e),alert("Ошибка при обновлении цены товара")}else alert("Не удалось рассчитать оптимальную цену");return t.data}}catch(e){console.error("Error calculating price:",e),alert("Ошибка при расчете цены")}return null},N=async()=>{try{console.log("Loading data..."),await h(),await f(),console.log("Data loaded successfully")}catch(e){console.error("Error loading data:",e)}};return((0,a.useEffect)(()=>{console.log("WbPricingPage mounted"),t(!0),N()},[]),e)?r.jsx(i.Z,{requiredRole:"client",children:r.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Wildberries - Ценообразование"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Автоматическое управление ценами и участие в акциях"})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Настройки ценообразования"}),(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Основные настройки маржинальности"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Наценка (%)"}),r.jsx("input",{type:"number",step:"0.1",value:s.markupPercent,onChange:e=>l(t=>({...t,markupPercent:Number(e.target.value)})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Эквайринг (%)"}),r.jsx("input",{type:"number",step:"0.1",value:s.acquiringPercent,onChange:e=>l(t=>({...t,acquiringPercent:Number(e.target.value)})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Комиссия маркетплейса (%)"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("input",{type:"number",step:"0.1",value:s.marketplaceCommissionPercent,onChange:e=>l(t=>({...t,marketplaceCommissionPercent:Number(e.target.value)})),className:"mt-1 block flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Получается из API WB"}),r.jsx("button",{onClick:j,className:"mt-1 px-3 py-2 text-sm rounded-md bg-blue-100 text-blue-800 hover:bg-blue-200",children:"Обновить"})]})]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Логистика (зависит от габаритов)"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Первый литр (₽)"}),r.jsx("input",{type:"number",step:"0.01",value:s.firstLiterLogisticsRub,onChange:e=>l(t=>({...t,firstLiterLogisticsRub:Number(e.target.value)})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Доп. литр (₽)"}),r.jsx("input",{type:"number",step:"0.01",value:s.additionalLiterLogisticsRub,onChange:e=>l(t=>({...t,additionalLiterLogisticsRub:Number(e.target.value)})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Коэф. склада (%)"}),r.jsx("input",{type:"number",step:"0.1",value:s.warehouseCoeffPercent,onChange:e=>l(t=>({...t,warehouseCoeffPercent:Number(e.target.value)})),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium text-gray-800 mb-3",children:"Управление акциями"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:s.maintainMarginInPromotions,onChange:e=>l(t=>({...t,maintainMarginInPromotions:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),r.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Удерживать маржинальность в акциях"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:s.autoExitPromotions,onChange:e=>l(t=>({...t,autoExitPromotions:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),r.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Автоматически выходить из акций"})]})]})]}),r.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"API ключ Wildberries"}),r.jsx("div",{className:"mt-1 text-sm text-blue-700",children:(0,r.jsxs)("p",{children:["Используется API ключ из настроек пользователя. Для изменения перейдите в ",r.jsx("strong",{children:"Настройки → API ключи"}),"."]})})]})]})}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Автоматизация:"}),r.jsx("button",{onClick:()=>p(!g),className:`px-3 py-1 rounded-full text-sm font-medium ${g?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:g?"Включена":"Отключена"})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("button",{onClick:b,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Сохранить настройки"}),r.jsx("button",{onClick:y,disabled:u,className:`px-4 py-2 rounded-md ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:u?"Синхронизация...":"Синхронизировать товары"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["Товары (",c.length,")"]}),d?r.jsx("div",{className:"text-center py-4",children:r.jsx("div",{className:"text-gray-500",children:"Загрузка товаров..."})}):c.length>0?(0,r.jsxs)("div",{className:"space-y-3",children:[c.slice(0,10).map((e,t)=>r.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.name||`Товар ${t+1}`}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.nm_id||"N/A"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Текущая цена: ",e.current_price?`${e.current_price} ₽`:"N/A",e.in_promotion&&r.jsx("span",{className:"ml-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"В акции"})]}),e.logistics_cost&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Логистика: ",(e.logistics_cost/100).toFixed(2)," ₽"]})]}),r.jsx("div",{className:"ml-4",children:r.jsx("button",{onClick:()=>v(e),className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-md hover:bg-blue-200",children:"Рассчитать цену"})})]})},t)),c.length>10&&(0,r.jsxs)("div",{className:"text-sm text-gray-500 text-center py-2",children:["... и еще ",c.length-10," товаров"]})]}):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("div",{className:"text-lg mb-2",children:"Товары не найдены"}),r.jsx("div",{className:"text-sm",children:'Нажмите "Синхронизировать товары" для загрузки из Wildberries'})]})]}),r.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded",children:"✅ Компонент работает корректно с API функциональностью"})]})})}):r.jsx(i.Z,{requiredRole:"client",children:r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsx("div",{className:"text-center",children:r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Загрузка..."})})})})}},3892:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,s(6843).createProxy)(String.raw`/home/samidius/MP/client/app/client/wb-pricing/page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[456,472,898,783,85],()=>s(1919));module.exports=r})();