(()=>{var e={};e.id=313,e.ids=[313],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5919:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>d});var s=r(482),a=r(9108),i=r(2563),n=r.n(i),l=r(8300),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);r.d(t,c);let d=["",{children:["client",{children:["products",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5598)),"/home/samidius/MP/client/app/client/products/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/home/samidius/MP/client/app/client/products/page.tsx"],x="/client/products/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/client/products/page",pathname:"/client/products",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4066:(e,t,r)=>{Promise.resolve().then(r.bind(r,7488))},7488:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(5344),a=r(8779),i=r(3729),n=r(8117),l=r(4669),c=r(3759),d=r(5965);function o(){let[e,t]=(0,i.useState)([]),[r,a]=(0,i.useState)([]),[o,x]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[m,h]=(0,i.useState)(""),[g,y]=(0,i.useState)(null),[f,b]=(0,i.useState)("none"),[v,j]=(0,i.useState)("asc"),[N,w]=(0,i.useState)(10),[_,k]=(0,i.useState)(1);(0,i.useEffect)(()=>{q()},[]),(0,i.useEffect)(()=>{C()},[e,m,g,f,v]);let q=async()=>{try{x(!0);let e=(await n.h.get("/client/store-products")).data.products||[];t(e)}catch(e){console.error("Error fetching products:",e),l.default.error(e.response?.data?.error||"Ошибка загрузки товаров")}finally{x(!1)}},C=()=>{let t=[...e];m&&(t=t.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.article.toLowerCase().includes(m.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(m.toLowerCase()))),null!==g&&(t=t.filter(e=>e.is_active===g)),"none"!==f&&t.sort((e,t)=>{let r,s;switch(f){case"name":r=e.name||"",s=t.name||"";break;case"brand":r=e.brand||"",s=t.brand||"";break;case"price":r=Number(e.current_price)||0,s=Number(t.current_price)||0;break;default:return 0}return"string"==typeof r?"asc"===v?r.localeCompare(s):s.localeCompare(r):(isNaN(r)&&(r=0),isNaN(s)&&(s=0),"asc"===v?r-s:s-r)}),a(t),k(1)},P=async()=>{try{p(!0);let e=await n.h.post("/client/store-products/load");l.default.success(e.data.message||`Загружено ${e.data.products?.length||0} товаров`),await q()}catch(e){console.error("Error loading cards:",e),l.default.error(e.response?.data?.error||"Ошибка загрузки карточек")}finally{p(!1)}},M=e=>e?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e):"—",E=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return o?s.jsx("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),s.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>s.jsx("div",{className:"h-24 bg-gray-200 rounded"},t))})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Товары магазина"}),s.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Просмотр и управление товарами Wildberries"})]}),(0,s.jsxs)("button",{onClick:P,disabled:u,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:[s.jsx(c.Z,{className:"w-4 h-4 mr-2"}),u?"Загрузка...":"Загрузить карточки"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(d.Z,{className:"h-5 w-5 text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"Поиск по названию, артикулу...",value:m,onChange:e=>h(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]}),(0,s.jsxs)("select",{value:null===g?"all":g?"active":"inactive",onChange:e=>{let t=e.target.value;y("all"===t?null:"active"===t)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"Все"}),s.jsx("option",{value:"active",children:"Активные"}),s.jsx("option",{value:"inactive",children:"Неактивные"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Сортировка:"}),(0,s.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"none",children:"Без сортировки"}),s.jsx("option",{value:"name",children:"По названию"}),s.jsx("option",{value:"brand",children:"По бренду"}),s.jsx("option",{value:"price",children:"По цене"})]}),"none"!==f&&s.jsx("button",{onClick:()=>j("asc"===v?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm",title:"asc"===v?"По возрастанию":"По убыванию",children:"asc"===v?"↑":"↓"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Товаров на странице:"}),(0,s.jsxs)("select",{value:N,onChange:e=>{w(Number(e.target.value)),k(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"10",children:"10"}),s.jsx("option",{value:"25",children:"25"}),s.jsx("option",{value:"50",children:"50"}),s.jsx("option",{value:"100",children:"100"})]})]})]})]}),0===r.length?s.jsx("div",{className:"card text-center",children:s.jsx("div",{className:"py-12",children:s.jsx("p",{className:"text-gray-500",children:'Товары не найдены. Нажмите "Загрузить карточки" для импорта товаров из Wildberries.'})})}):(0,s.jsxs)("div",{className:"card",children:[s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Товар"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Артикул / nmId"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Цена"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Комиссия"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Логистика"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Статус"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Обновлено"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.slice((_-1)*N,_*N).map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.brand&&s.jsx("div",{className:"text-sm text-gray-500",children:e.brand}),e.category&&s.jsx("div",{className:"text-xs text-gray-400",children:e.category})]})}),(0,s.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"text-sm text-gray-900",children:e.article}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["nmId: ",e.nm_id]})]}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:M(e.current_price)}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.commission_percent?`${e.commission_percent}%`:"—"}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:M(e.logistics_cost)}),(0,s.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap",children:[s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.is_active?"Активен":"Неактивен"}),e.in_promotion&&(0,s.jsxs)("div",{className:"text-xs text-purple-600 mt-1",children:["В акции: ",e.promotion_discount_percent,"%"]})]}),s.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-xs text-gray-500",children:E(e.last_updated)})]},e.id))})]})}),Math.ceil(r.length/N)>1&&(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:["Показано ",(_-1)*N+1," - ",Math.min(_*N,r.length)," из ",r.length]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>k(Math.max(1,_-1)),disabled:1===_,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),s.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(r.length/N))},(e,t)=>{let a;let i=Math.ceil(r.length/N);return a=i<=5?t+1:_<=3?t+1:_>=i-2?i-4+t:_-2+t,s.jsx("button",{onClick:()=>k(a),className:`px-3 py-1 text-sm font-medium rounded-md ${_===a?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:a},a)})}),s.jsx("button",{onClick:()=>k(Math.min(Math.ceil(r.length/N),_+1)),disabled:_>=Math.ceil(r.length/N),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]})]}),r.length>0&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Всего товаров"}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:r.length})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Активных"}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:r.filter(e=>e.is_active).length})]}),(0,s.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"В акциях"}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:r.filter(e=>e.in_promotion).length})]}),(0,s.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Средняя цена"}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:M(r.reduce((e,t)=>e+(t.current_price||0),0)/r.length)})]})]})]})}function x(){return s.jsx(a.Z,{requiredRole:"client",children:s.jsx(o,{})})}},5598:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let s=(0,r(6843).createProxy)(String.raw`/home/samidius/MP/client/app/client/products/page.tsx`),{__esModule:a,$$typeof:i}=s,n=s.default},5965:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(3729);let a=s.forwardRef(function({title:e,titleId:t,...r},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})},3759:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(3729);let a=s.forwardRef(function({title:e,titleId:t,...r},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[456,472,898,783,838],()=>r(5919));module.exports=s})();