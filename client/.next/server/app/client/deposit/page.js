(()=>{var e={};e.id=572,e.ids=[572],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},499:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>d});var r=s(482),a=s(9108),l=s(2563),n=s.n(l),i=s(8300),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let d=["",{children:["client",{children:["deposit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4625)),"/home/samidius/MP/client/app/client/deposit/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/home/samidius/MP/client/app/client/deposit/page.tsx"],x="/client/deposit/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/client/deposit/page",pathname:"/client/deposit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9202:(e,t,s)=>{Promise.resolve().then(s.bind(s,1582))},1582:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(5344),a=s(3729),l=s(8779),n=s(8117),i=s(4669);let c=a.forwardRef(function({title:e,titleId:t,...s},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}),d=a.forwardRef(function({title:e,titleId:t,...s},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))});var o=s(7850),x=s(3759);function m(){let[e,t]=(0,a.useState)(0),[s,m]=(0,a.useState)([]),[u,p]=(0,a.useState)(!0),[h,g]=(0,a.useState)(!1),[j,f]=(0,a.useState)(""),[v,y]=(0,a.useState)("sbp"),[b,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[q,_]=(0,a.useState)(null),[C,L]=(0,a.useState)("pending");(0,a.useEffect)(()=>{P()},[]);let P=async()=>{try{let[e,s]=await Promise.all([n.h.get("/client/balance"),n.h.get("/client/deposits?limit=20")]);t(e.data.balance),m(s.data.deposits)}catch(e){console.error("Error fetching deposit data:",e),i.default.error("Ошибка загрузки данных")}finally{p(!1)}},M=async e=>{if(e.preventDefault(),!j||0>=parseFloat(j)){i.default.error("Введите корректную сумму");return}N(!0);try{let{paymentUrl:e,invoiceFile:t}=(await n.h.post("/payment/deposit",{amount:parseFloat(j),payment_method:v})).data;e&&("bank_transfer"===e.type?(i.default.success("Реквизиты для перевода отправлены на email"),console.log("Bank transfer details:",e.details)):"sbp"===e.type?e.qrCode?(k(!0),_({qrCode:e.qrCode,qrCodeUrl:e.qrCodeUrl,paymentUrl:e.paymentUrl,orderId:e.orderId,amount:e.amount})):e.paymentUrl?window.open(e.paymentUrl,"_blank"):e.error&&i.default.error(e.error):window.open(e.url,"_blank")),t&&i.default.success("PDF счет сгенерирован. Вы можете скачать его ниже."),g(!1),f(""),i.default.success("Платеж создан успешно")}catch(e){i.default.error(e.response?.data?.error||"Ошибка создания платежа")}finally{N(!1)}},S=e=>{switch(e){case"deposit":return r.jsx(c,{className:"h-5 w-5 text-green-600"});case"withdrawal":return r.jsx(d,{className:"h-5 w-5 text-red-600"});case"order_payment":return r.jsx(o.Z,{className:"h-5 w-5 text-blue-600"});default:return r.jsx(o.Z,{className:"h-5 w-5 text-gray-600"})}},E=e=>{switch(e){case"deposit":return"Пополнение";case"withdrawal":return"Списание";case"order_payment":return"Оплата заказа";default:return e}},R=async e=>{try{let{status:t,localStatus:s}=(await n.h.get(`/payment/sbp-status/${e}`)).data;L(t),"1"===t&&"completed"===s?(i.default.success("Платеж успешно завершен!"),k(!1),P()):("2"===t||"3"===t)&&(i.default.error("Платеж отклонен или отменен"),k(!1))}catch(e){console.error("Error checking SBP status:",e)}};(0,a.useEffect)(()=>{if(w&&q?.orderId){let e=setInterval(()=>{R(q.orderId)},5e3);return()=>clearInterval(e)}},[w,q]);let U=e=>{switch(e){case"completed":return r.jsx("span",{className:"badge-success",children:"Завершено"});case"pending":return r.jsx("span",{className:"badge-warning",children:"Ожидает"});case"failed":return r.jsx("span",{className:"badge-danger",children:"Ошибка"});default:return r.jsx("span",{className:"badge-gray",children:e})}};return u?r.jsx(l.Z,{requiredRole:"client",children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):(0,r.jsxs)(l.Z,{requiredRole:"client",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Депозит"}),r.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Управление балансом и история операций"})]}),(0,r.jsxs)("button",{onClick:()=>g(!0),className:"btn-primary",children:[r.jsx(x.Z,{className:"h-5 w-5 mr-2"}),"Пополнить"]})]}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"card-body",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Текущий баланс"}),(0,r.jsxs)("p",{className:"text-3xl font-bold text-primary-600",children:[e.toLocaleString("ru-RU")," ₽"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm text-gray-500",children:"Доступно для заказов"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[e.toLocaleString("ru-RU")," ₽"]})]})]})})}),h&&(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Пополнить депозит"})}),r.jsx("div",{className:"card-body",children:(0,r.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:"Сумма пополнения"}),r.jsx("input",{type:"number",value:j,onChange:e=>f(e.target.value),className:"input",placeholder:"Введите сумму",min:"1",step:"0.01",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"label",children:"Способ оплаты"}),(0,r.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"input",children:[r.jsx("option",{value:"sbp",children:"СБП"}),r.jsx("option",{value:"yukassa",children:"ЮKassa"}),r.jsx("option",{value:"tinkoff",children:"Тинькофф"}),r.jsx("option",{value:"bank_transfer",children:"Банковский перевод"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Отмена"}),r.jsx("button",{type:"submit",disabled:b,className:"btn-primary",children:b?"Создание...":"Создать платеж"})]})]})})]}),(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"История операций"})}),r.jsx("div",{className:"card-body",children:s.length>0?r.jsx("div",{className:"space-y-4",children:s.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[S(e.transaction_type),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:E(e.transaction_type)}),r.jsx("p",{className:"text-sm text-gray-500",children:e.description}),r.jsx("p",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleString("ru-RU")})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:`text-sm font-medium ${e.amount>0?"text-green-600":"text-red-600"}`,children:[e.amount>0?"+":"",e.amount.toLocaleString("ru-RU")," ₽"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Баланс: ",e.balance_after.toLocaleString("ru-RU")," ₽"]}),r.jsx("div",{className:"mt-1",children:U(e.status)})]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-6",children:[r.jsx(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Нет операций"}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"История операций с депозитом появится здесь."})]})})]})]}),w&&q&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Оплата через СБП"}),r.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-600 mb-4",children:"Отсканируйте QR-код в приложении вашего банка для оплаты"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:[q.amount," ₽"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["ID заказа: ",q.orderId]})]}),q.qrCode&&r.jsx("div",{className:"mb-4",children:r.jsx("img",{src:q.qrCodeUrl||`data:image/png;base64,${q.qrCode}`,alt:"QR код для оплаты",className:"mx-auto border border-gray-200 rounded",style:{width:"200px",height:"200px"}})}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Статус:"}),(0,r.jsxs)("div",{className:"flex items-center justify-center",children:["pending"===C&&(0,r.jsxs)("div",{className:"flex items-center text-yellow-600",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 mr-2"}),"Ожидание оплаты..."]}),"1"===C&&(0,r.jsxs)("div",{className:"flex items-center text-green-600",children:[r.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Оплачено"]}),("2"===C||"3"===C)&&(0,r.jsxs)("div",{className:"flex items-center text-red-600",children:[r.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"Отклонено"]})]})]}),q.paymentUrl&&r.jsx("div",{className:"mb-4",children:(0,r.jsxs)("a",{href:q.paymentUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[r.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Открыть в браузере"]})}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[r.jsx("button",{onClick:()=>R(q.orderId),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Проверить статус"}),r.jsx("button",{onClick:()=>k(!1),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Закрыть"})]})]})]})})]})}},4625:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>a,default:()=>n});let r=(0,s(6843).createProxy)(String.raw`/home/samidius/MP/client/app/client/deposit/page.tsx`),{__esModule:a,$$typeof:l}=r,n=r.default},3759:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(3729);let a=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[456,472,898,783,85],()=>s(499));module.exports=r})();