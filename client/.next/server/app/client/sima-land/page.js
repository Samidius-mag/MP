(()=>{var e={};e.id=469,e.ids=[469],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},346:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var s=r(482),a=r(9108),i=r(2563),n=r.n(i),l=r(8300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["client",{children:["sima-land",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4704)),"/home/samidius/MP/client/app/client/sima-land/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,8762)),"/home/samidius/MP/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,4697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/samidius/MP/client/app/client/sima-land/page.tsx"],u="/client/sima-land/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/client/sima-land/page",pathname:"/client/sima-land",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6297:(e,t,r)=>{Promise.resolve().then(r.bind(r,8748))},8748:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5344),a=r(8779),i=r(3729),n=r(8117),l=r(4669),o=r(3759),c=r(5965);let d=i.forwardRef(function({title:e,titleId:t,...r},s){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))});function u(){let[e,t]=(0,i.useState)([]),[r,a]=(0,i.useState)([]),[u,m]=(0,i.useState)(!1),[x,p]=(0,i.useState)(!1),[h,g]=(0,i.useState)(""),[b,f]=(0,i.useState)("none"),[y,v]=(0,i.useState)("asc"),[j,w]=(0,i.useState)(10),[N,_]=(0,i.useState)(1),[k,q]=(0,i.useState)(!1);(0,i.useEffect)(()=>{P(),C()},[]),(0,i.useEffect)(()=>{M()},[e,h,b,y]);let P=async()=>{try{let e=await n.h.get("/client/api-keys"),t=e.data.apiKeys?.sima_land?.token;q(t&&""!==t.trim())}catch(e){console.error("Error checking token:",e),q(!1)}},C=async()=>{try{m(!0);let e=(await n.h.get("/client/sima-land/products")).data.products||[];t(e)}catch(e){console.error("Error fetching products:",e),e.response?.status===400?l.default.error(e.response?.data?.error||"Необходимо настроить токен API"):l.default.error(e.response?.data?.error||"Ошибка загрузки товаров")}finally{m(!1)}},E=async()=>{try{p(!0);let e=await n.h.post("/client/sima-land/products/load");l.default.success(e.data.message||`Загружено ${e.data.products?.length||0} товаров`),await C()}catch(e){console.error("Error loading products:",e),l.default.error(e.response?.data?.error||"Ошибка загрузки товаров")}finally{p(!1)}},M=()=>{let t=[...e];h&&(t=t.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.article.toLowerCase().includes(h.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(h.toLowerCase()))),"none"!==b&&t.sort((e,t)=>{let r,s;switch(b){case"name":r=e.name||"",s=t.name||"";break;case"brand":r=e.brand||"",s=t.brand||"";break;case"price":r=Number(e.purchase_price)||0,s=Number(t.purchase_price)||0;break;default:return 0}return"string"==typeof r?"asc"===y?r.localeCompare(s):s.localeCompare(r):(isNaN(r)&&(r=0),isNaN(s)&&(s=0),"asc"===y?r-s:s-r)}),a(t),_(1)},L=e=>e?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e):"—",S=async e=>{try{await n.h.post("/client/sima-land/products/add",{article:e.article,name:e.name,brand:e.brand,category:e.category,purchase_price:e.purchase_price,image_url:e.image_url}),l.default.success("Товар добавлен в магазин"),await C()}catch(e){console.error("Error adding product:",e),l.default.error(e.response?.data?.error||"Ошибка добавления товара")}};return u?s.jsx("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),s.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>s.jsx("div",{className:"h-24 bg-gray-200 rounded"},t))})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Товары СИМА ЛЕНД"}),s.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Выберите товары поставщика для добавления в ваш магазин"})]}),(0,s.jsxs)("button",{onClick:E,disabled:x||!k,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:[s.jsx(o.Z,{className:"w-4 h-4 mr-2"}),x?"Загрузка...":"Загрузить товары"]})]}),!k&&s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:s.jsx("p",{className:"text-sm text-yellow-800",children:"Для работы с товарами СИМА ЛЕНД необходимо настроить токен API в разделе \xabНастройки\xbb."})}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,s.jsxs)("div",{className:"flex-1 relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(c.Z,{className:"h-5 w-5 text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"Поиск по названию, артикулу...",value:h,onChange:e=>g(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]})}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Сортировка:"}),(0,s.jsxs)("select",{value:b,onChange:e=>f(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"none",children:"Без сортировки"}),s.jsx("option",{value:"name",children:"По названию"}),s.jsx("option",{value:"brand",children:"По бренду"}),s.jsx("option",{value:"price",children:"По цене"})]}),"none"!==b&&s.jsx("button",{onClick:()=>v("asc"===y?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm",title:"asc"===y?"По возрастанию":"По убыванию",children:"asc"===y?"↑":"↓"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Товаров на странице:"}),(0,s.jsxs)("select",{value:j,onChange:e=>{w(Number(e.target.value)),_(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"10",children:"10"}),s.jsx("option",{value:"25",children:"25"}),s.jsx("option",{value:"50",children:"50"}),s.jsx("option",{value:"100",children:"100"})]})]})]})]}),0===r.length?s.jsx("div",{className:"card text-center",children:(0,s.jsxs)("div",{className:"py-12",children:[s.jsx(d,{className:"mx-auto h-12 w-12 text-gray-400"}),s.jsx("p",{className:"mt-4 text-gray-500",children:'Товары не найдены. Нажмите "Загрузить товары" для импорта товаров из СИМА ЛЕНД.'})]})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.slice((N-1)*j,N*j).map(e=>(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"aspect-w-16 aspect-h-9 bg-gray-200",children:e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-48 object-cover"}):s.jsx("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center",children:s.jsx(d,{className:"h-12 w-12 text-gray-400"})})}),(0,s.jsxs)("div",{className:"p-4",children:[s.jsx("div",{className:"flex justify-between items-start mb-2",children:s.jsx("h3",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.name})}),e.brand&&s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e.brand}),e.category&&s.jsx("p",{className:"text-xs text-blue-600 mb-2",children:e.category}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-lg font-semibold text-gray-900",children:L(e.purchase_price)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Остаток: ",e.available_quantity||0]})]}),s.jsx("button",{onClick:()=>S(e),className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Добавить"})]})]})]},e.id))}),Math.ceil(r.length/j)>1&&(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:["Показано ",(N-1)*j+1," - ",Math.min(N*j,r.length)," из ",r.length]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>_(Math.max(1,N-1)),disabled:1===N,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Назад"}),s.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(r.length/j))},(e,t)=>{let a;let i=Math.ceil(r.length/j);return a=i<=5?t+1:N<=3?t+1:N>=i-2?i-4+t:N-2+t,s.jsx("button",{onClick:()=>_(a),className:`px-3 py-1 text-sm font-medium rounded-md ${N===a?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:a},a)})}),s.jsx("button",{onClick:()=>_(Math.min(Math.ceil(r.length/j),N+1)),disabled:N>=Math.ceil(r.length/j),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Вперед"})]})]}),r.length>0&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Всего товаров"}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:r.length})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Доступно"}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:r.filter(e=>(e.available_quantity||0)>0).length})]}),(0,s.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Средняя цена"}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:L(r.reduce((e,t)=>e+(t.purchase_price||0),0)/r.length)})]})]})]})}function m(){return s.jsx(a.Z,{requiredRole:"client",children:s.jsx(u,{})})}},4704:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let s=(0,r(6843).createProxy)(String.raw`/home/samidius/MP/client/app/client/sima-land/page.tsx`),{__esModule:a,$$typeof:i}=s,n=s.default},5965:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(3729);let a=s.forwardRef(function({title:e,titleId:t,...r},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))})},3759:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(3729);let a=s.forwardRef(function({title:e,titleId:t,...r},a){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[456,472,898,783,838],()=>r(346));module.exports=s})();