exports.id=505,exports.ids=[505],exports.modules={2676:(e,t,r)=>{Promise.resolve().then(r.bind(r,843)),Promise.resolve().then(r.bind(r,4669))},5517:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},9048:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var a=r(5344),s=r(3729),o=r(708),l=r(843),n=r(2254),i=r(4669),c=r(783),d=r.n(c);function u({userId:e,onComplete:t}){let[r,o]=(0,s.useState)(""),[n,c]=(0,s.useState)(!1),{verifyTwoFactor:d}=(0,l.useAuth)(),u=async a=>{if(a.preventDefault(),6!==r.length){i.default.error("Введите 6-значный код");return}c(!0);try{let a=await d(e,r);t(a),i.default.success("2FA подтвержден успешно")}catch(e){i.default.error(e.message||"Ошибка подтверждения 2FA")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Двухфакторная аутентификация"}),a.jsx("p",{className:"mt-2 text-gray-600",children:"Введите код из приложения аутентификатора"})]}),(0,a.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"code",className:"label",children:"Код аутентификации"}),a.jsx("input",{type:"text",value:r,onChange:e=>o(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"input text-center text-lg tracking-widest",maxLength:6,autoComplete:"off"})]}),a.jsx("button",{type:"submit",disabled:n||6!==r.length,className:"btn-primary w-full",children:n?"Проверка...":"Подтвердить"})]})]})}function h({userId:e,onComplete:t}){let[r,o]=(0,s.useState)(""),[n,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[h,m]=(0,s.useState)(!1),{forceChangePassword:p}=(0,l.useAuth)(),x=async a=>{if(a.preventDefault(),n!==d){i.default.error("Пароли не совпадают");return}if(n.length<8){i.default.error("Пароль должен содержать минимум 8 символов");return}m(!0);try{await p(e,r,n),i.default.success("Пароль успешно изменен"),t()}catch(e){i.default.error(e.message||"Ошибка смены пароля")}finally{m(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Смена пароля"}),a.jsx("p",{className:"mt-2 text-gray-600",children:"Необходимо сменить пароль при первом входе"})]}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"currentPassword",className:"label",children:"Текущий пароль"}),a.jsx("input",{type:"password",value:r,onChange:e=>o(e.target.value),className:"input",placeholder:"Введите текущий пароль",required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"newPassword",className:"label",children:"Новый пароль"}),a.jsx("input",{type:"password",value:n,onChange:e=>c(e.target.value),className:"input",placeholder:"Введите новый пароль",required:!0,minLength:8}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Минимум 8 символов, 1 заглавная буква, 1 спецсимвол"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"confirmPassword",className:"label",children:"Подтверждение пароля"}),a.jsx("input",{type:"password",value:d,onChange:e=>u(e.target.value),className:"input",placeholder:"Подтвердите новый пароль",required:!0,minLength:8})]}),a.jsx("button",{type:"submit",disabled:h||!r||!n||!d,className:"btn-primary w-full",children:h?"Смена пароля...":"Сменить пароль"})]})]})}function m(){let[e,t]=(0,s.useState)(!1),[r,c]=(0,s.useState)("login"),[m,p]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),{login:g,verifyTwoFactor:y,forceChangePassword:w}=(0,l.useAuth)();(0,n.useRouter)();let{register:b,handleSubmit:v,formState:{errors:j}}=(0,o.cI)(),N=async e=>{t(!0);try{let t=await g(e.email,e.password);t.requiresTwoFactor?(p({userId:t.userId}),c("2fa")):t.requiresPasswordChange?(f({userId:t.userId}),c("password-change")):i.default.success("Вход выполнен успешно")}catch(e){i.default.error(e.message||"Ошибка входа")}finally{t(!1)}},A=async e=>{i.default.success("Вход выполнен успешно"),window.location.href="/client/dashboard"};return"2fa"===r&&m?a.jsx(u,{userId:m.userId,onComplete:A}):"password-change"===r&&x?a.jsx(h,{userId:x.userId,onComplete:()=>{i.default.success("Пароль успешно изменен. Войдите в систему с новым паролем."),c("login"),f(null)}}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("form",{className:"space-y-6",onSubmit:v(N),children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"email",className:"label",children:"Email или телефон"}),a.jsx("input",{...b("email",{required:"Email или телефон обязателен",pattern:{value:/^([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}|[\+]?[1-9][\d]{0,15})$/i,message:"Неверный формат email или телефона"}}),type:"text",className:`input ${j.email?"input-error":""}`,placeholder:"Введите email или телефон",autoComplete:"off"}),j.email&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.email.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"password",className:"label",children:"Пароль"}),a.jsx("input",{...b("password",{required:"Пароль обязателен"}),type:"password",className:`input ${j.password?"input-error":""}`,placeholder:"Введите ваш пароль",autoComplete:"current-password"}),j.password&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.password.message})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{...b("rememberMe"),type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),a.jsx("label",{htmlFor:"rememberMe",className:"ml-2 text-sm text-gray-700",children:"Запомнить меня"})]}),a.jsx("div",{className:"text-sm",children:a.jsx("a",{href:"/forgot-password",className:"text-blue-600 hover:text-blue-500",children:"Забыли пароль?"})})]}),a.jsx("div",{children:a.jsx("button",{type:"submit",disabled:e,className:"btn-primary w-full",children:e?"Вход...":"Войти"})})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 flex items-center",children:a.jsx("div",{className:"w-full border-t border-gray-300"})}),a.jsx("div",{className:"relative flex justify-center text-sm",children:a.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Или"})})]}),a.jsx("div",{className:"mt-6",children:a.jsx(d(),{href:"/register",className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Создать аккаунт"})})]})]})}},8117:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});let a=r(1934).Z.create({baseURL:"https://vgk-perv.ru/api",headers:{"Content-Type":"application/json"}});a.interceptors.response.use(e=>e,e=>((e.response?.status===401||e.response?.status===403)&&(localStorage.removeItem("token"),delete a.defaults.headers.common.Authorization,window.location.href="/login"),Promise.reject(e))),a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e))},843:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthProvider:()=>c,useAuth:()=>d});var a=r(5344),s=r(3729),o=r(8117);class l{constructor(){this.isEnabled=!0,this.isEnabled=!1}async sendLog(e,t,r={}){if(this.isEnabled)try{await o.h.post("/admin/logs/client",{level:e,message:t,component:r.component,action:r.action,url:r.url||window.location.href,metadata:r.metadata})}catch(e){console.warn("Failed to send client log:",e)}}error(e,t){console.error(`[CLIENT ERROR] ${e}`,t),this.sendLog("error",e,t)}warn(e,t){console.warn(`[CLIENT WARN] ${e}`,t),this.sendLog("warn",e,t)}info(e,t){console.info(`[CLIENT INFO] ${e}`,t),this.sendLog("info",e,t)}debug(e,t){console.debug(`[CLIENT DEBUG] ${e}`,t),this.sendLog("debug",e,t)}userAction(e,t,r){this.info(`User action: ${e}`,{component:t,action:e,metadata:r})}apiError(e,t,r){this.error(`API Error: ${e}`,{component:"API",action:"request",metadata:{endpoint:e,error:t?.message||t,status:t?.response?.status,...r}})}navigation(e,t){this.info(`Navigation: ${e} -> ${t}`,{component:"Router",action:"navigation",metadata:{from:e,to:t}})}componentError(e,t,r){this.error(`Component Error: ${e}`,{component:e,action:"render",metadata:{error:t?.message||t,stack:t?.stack,...r}})}}let n=new l,i=(0,s.createContext)(void 0);function c({children:e}){let[t,r]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=localStorage.getItem("token");if(!e){c(!1);return}o.h.defaults.headers.common.Authorization=`Bearer ${e}`;let t=await o.h.get("/auth/profile");r(t.data)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("token"),delete o.h.defaults.headers.common.Authorization}finally{c(!1)}},u=async(e,t)=>{try{n.info("Login attempt",{component:"Auth",action:"login",metadata:{email:e}});let{user:a,token:s,requiresTwoFactor:l,userId:i,requiresPasswordChange:c}=(await o.h.post("/auth/login",{email:e,password:t})).data;if(l)return{requiresTwoFactor:!0,userId:i};if(c)return{requiresPasswordChange:!0,userId:i};return localStorage.setItem("token",s),o.h.defaults.headers.common.Authorization=`Bearer ${s}`,r(a),n.info("Login successful",{component:"Auth",action:"login",metadata:{userId:a.id,email:e}}),{}}catch(a){let t=a?.response?.status,r=a?.response?.data?.error;throw n.apiError("/auth/login",a,{email:e}),Error(401===t?"Неверный email или пароль":500===t?"Ошибка сервера при входе":r||"Ошибка входа")}},h=async e=>{try{let{userId:t,email:r}=(await o.h.post("/auth/register",e)).data;return{userId:t,email:r}}catch(r){let e=r?.response?.status,t=r?.response?.data?.error;throw Error(409===e?"Пользователь с таким email уже существует":t||"Ошибка регистрации")}},m=async e=>{try{let t=await o.h.put("/auth/profile",e);r(e=>e?{...e,...t.data}:null)}catch(e){throw Error(e.response?.data?.error||"Ошибка обновления профиля")}},p=async(e,t)=>{try{let{token:a,user:s}=(await o.h.post("/auth/verify-2fa",{userId:e,code:t})).data;return localStorage.setItem("token",a),o.h.defaults.headers.common.Authorization=`Bearer ${a}`,r(s),a}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения 2FA")}},x=async(e,t)=>{try{let{token:a,user:s}=(await o.h.post("/auth/verify-email",{userId:e,code:t})).data;return a&&(localStorage.setItem("token",a),o.h.defaults.headers.common.Authorization=`Bearer ${a}`,r(s)),a}catch(e){throw Error(e?.response?.data?.error||"Ошибка подтверждения email")}},f=async(e,t)=>{try{await o.h.post("/auth/resend-code",{userId:e,type:t})}catch(e){throw Error(e?.response?.data?.error||"Ошибка отправки кода")}},g=async e=>{try{return(await o.h.post("/auth/check-company",{inn:e})).data}catch(e){throw Error(e?.response?.data?.error||"Ошибка проверки компании")}},y=async(e,t,r)=>{try{await o.h.put("/auth/force-change-password",{userId:e,currentPassword:t,newPassword:r})}catch(e){throw Error(e?.response?.data?.error||"Ошибка смены пароля")}};return a.jsx(i.Provider,{value:{user:t,loading:l,login:u,register:h,logout:()=>{n.info("User logout",{component:"Auth",action:"logout",metadata:{userId:t?.id}}),localStorage.removeItem("token"),delete o.h.defaults.headers.common.Authorization,r(null),window.location.href="/login"},updateProfile:m,verifyTwoFactor:p,verifyEmail:x,resendCode:f,checkCompany:g,forceChangePassword:y},children:e})}function d(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8762:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>h});var a=r(5036),s=r(8592),o=r.n(s);r(7272);var l=r(6843);let n=(0,l.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx`),{__esModule:i,$$typeof:c}=n;n.default;let d=(0,l.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#AuthProvider`);(0,l.createProxy)(String.raw`/home/samidius/MP/client/lib/auth-context.tsx#useAuth`);var u=r(9636);let h={title:"Система автоматизации дропшиппинга",description:"Веб-система с личными кабинетами для клиентов и операторов"};function m({children:e}){return a.jsx("html",{lang:"ru",children:a.jsx("body",{className:o().className,children:(0,a.jsxs)(d,{children:[e,a.jsx(u.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})})})}},4697:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(337);let s=e=>[{type:"image/svg+xml",sizes:"any",url:(0,a.fillMetadataSegment)(".",e.params,"icon.svg")+"?5a14f14a44901342"}]},7272:()=>{}};