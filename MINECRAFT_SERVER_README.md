# Minecraft Server Integration

Серверная часть для игры Minecraft интегрирована в проект и работает на порту **27015**.

## Настройка

### 1. Установка зависимостей

```bash
cd server
npm install
```

### 2. Настройка переменных окружения

Добавьте следующие переменные в файл `.env` или `env.example`:

```env
# Minecraft Server
MINECRAFT_PORT=27015
MINECRAFT_VERSION=1.20.1
MINECRAFT_MOTD=Minecraft Server
MINECRAFT_MAX_PLAYERS=20
MINECRAFT_ONLINE_MODE=true
```

### 3. Запуск миграции базы данных

Создайте таблицу для хранения информации об игроках:

```bash
# Миграция уже создана в server/migrations/20250128_create_minecraft_players.sql
# Запустите миграцию через ваш обычный процесс миграций
```

## Запуск сервера

Minecraft сервер автоматически запускается вместе с основным Express сервером:

```bash
cd server
npm start
```

Сервер будет доступен на порту **27015**.

## Подключение к серверу

Игроки могут подключиться к серверу используя:
- **Адрес**: `localhost:27015` (для локального подключения)
- **Версия**: 1.20.1 (или версия, указанная в `MINECRAFT_VERSION`)

## API Endpoints

### Получение статистики сервера
```
GET /api/minecraft/stats
```
Требует авторизации администратора.

**Ответ:**
```json
{
  "success": true,
  "stats": {
    "isRunning": true,
    "onlinePlayers": 2,
    "totalPlayersInDB": 10
  },
  "onlinePlayers": [
    {
      "username": "Player1",
      "uuid": "uuid-here",
      "connectedAt": "2025-01-28T10:00:00.000Z"
    }
  ],
  "recentPlayers": [...]
}
```

### Получение списка игроков
```
GET /api/minecraft/players
```
Требует авторизации администратора.

### Управление сервером
```
POST /api/minecraft/start   - Запустить сервер
POST /api/minecraft/stop    - Остановить сервер
POST /api/minecraft/restart - Перезапустить сервер
```
Все эндпоинты требуют авторизации администратора.

## Команды в игре

Игроки могут использовать следующие команды в чате:

- `/help` - Показать список доступных команд
- `/list` - Показать список игроков онлайн
- `/time` - Показать текущее время

## Функциональность

- ✅ Подключение и отключение игроков
- ✅ Сохранение информации об игроках в базе данных
- ✅ Логирование событий сервера
- ✅ Чат между игроками
- ✅ Система команд
- ✅ API для управления сервером
- ✅ Статистика и мониторинг

## Структура файлов

- `server/minecraft-server.js` - Основной файл сервера
- `server/services/minecraftService.js` - Сервис для работы с базой данных
- `server/routes/minecraft.js` - API роуты для управления сервером
- `server/migrations/20250128_create_minecraft_players.sql` - Миграция для таблицы игроков

## Примечания

- Сервер использует библиотеку `minecraft-protocol` для работы с протоколом Minecraft
- По умолчанию включен онлайн-режим (проверка через Mojang API)
- Все события логируются в таблицу `server_logs` с сервисом `minecraft`
- Информация об игроках сохраняется в таблице `minecraft_players`

## Устранение неполадок

### Сервер не запускается
- Проверьте, что порт 27015 не занят другим приложением
- Убедитесь, что все зависимости установлены
- Проверьте логи в консоли

### Игроки не могут подключиться
- Проверьте настройки файрвола
- Убедитесь, что порт открыт для входящих соединений
- Проверьте версию клиента Minecraft (должна совпадать с версией сервера)

### Ошибки базы данных
- Убедитесь, что миграция выполнена
- Проверьте подключение к базе данных
- Проверьте права доступа пользователя базы данных

